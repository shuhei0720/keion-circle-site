# ç¬¬36ç« ï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æœªæ¥ã¨æ‹¡å¼µæ€§

ã“ã®æœ€çµ‚ç« ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å°†æ¥çš„ãªæ‹¡å¼µæ€§ã¨ã€ã•ã‚‰ãªã‚‹å­¦ç¿’ã®ãŸã‚ã®ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã«ã¤ã„ã¦è§£èª¬ã—ã¾ã™ã€‚

## 36.1 å°†æ¥ã®æ©Ÿèƒ½æ‹¡å¼µ

### ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªåŒ–

#### React Nativeã§ã®å®Ÿè£…

```typescript
// ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã®å¯èƒ½æ€§
// React Nativeã‚’ä½¿ç”¨ã—ãŸã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ é–‹ç™º

// å…±æœ‰å¯èƒ½ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
// lib/api-client.ts (Web/Mobileå…±é€š)
export class ApiClient {
  private baseUrl: string;
  
  constructor(baseUrl: string) {
    this.baseUrl = baseUrl;
  }
  
  async getPosts(page = 1) {
    const response = await fetch(`${this.baseUrl}/api/posts?page=${page}`);
    return response.json();
  }
  
  async createPost(data: CreatePostData) {
    const response = await fetch(`${this.baseUrl}/api/posts`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    return response.json();
  }
}

// ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å®Ÿè£…
import * as Notifications from 'expo-notifications';

async function registerForPushNotifications() {
  const { status } = await Notifications.requestPermissionsAsync();
  if (status !== 'granted') {
    return;
  }
  
  const token = await Notifications.getExpoPushTokenAsync();
  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
  await fetch('/api/push-tokens', {
    method: 'POST',
    body: JSON.stringify({ token: token.data }),
  });
}
```

#### PWAã®å¼·åŒ–

```typescript
// ã‚ˆã‚Šé«˜åº¦ãªPWAæ©Ÿèƒ½

// service-worker.js - ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸ
self.addEventListener('sync', (event) => {
  if (event.tag === 'sync-posts') {
    event.waitUntil(syncPosts());
  }
});

async function syncPosts() {
  const db = await openDB('offline-posts', 1);
  const posts = await db.getAll('pending');
  
  for (const post of posts) {
    try {
      await fetch('/api/posts', {
        method: 'POST',
        body: JSON.stringify(post),
      });
      await db.delete('pending', post.id);
    } catch (error) {
      console.error('Sync failed:', error);
    }
  }
}

// ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®å—ä¿¡
self.addEventListener('push', (event) => {
  const data = event.data.json();
  
  event.waitUntil(
    self.registration.showNotification(data.title, {
      body: data.body,
      icon: '/icon-192x192.png',
      badge: '/badge-72x72.png',
      data: data.url,
    })
  );
});
```

---

### ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

#### WebSocketã®å®Ÿè£…

```typescript
// lib/websocket-server.ts
import { Server } from 'socket.io';
import type { Server as HTTPServer } from 'http';

export function setupWebSocket(httpServer: HTTPServer) {
  const io = new Server(httpServer, {
    cors: {
      origin: process.env.NEXT_PUBLIC_APP_URL,
      credentials: true,
    },
  });
  
  io.on('connection', (socket) => {
    console.log('Client connected:', socket.id);
    
    // éƒ¨å±‹ã¸ã®å‚åŠ 
    socket.on('join-room', (roomId: string) => {
      socket.join(roomId);
      socket.to(roomId).emit('user-joined', socket.id);
    });
    
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç·¨é›†
    socket.on('document-update', (data) => {
      socket.to(data.roomId).emit('document-update', data);
    });
    
    // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
    socket.on('typing', (data) => {
      socket.to(data.roomId).emit('user-typing', {
        userId: socket.id,
        userName: data.userName,
      });
    });
    
    socket.on('disconnect', () => {
      console.log('Client disconnected:', socket.id);
    });
  });
  
  return io;
}

// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®å®Ÿè£…
// hooks/useWebSocket.ts
import { useEffect, useRef, useState } from 'react';
import { io, Socket } from 'socket.io-client';

export function useWebSocket(roomId: string) {
  const [isConnected, setIsConnected] = useState(false);
  const socketRef = useRef<Socket | null>(null);
  
  useEffect(() => {
    const socket = io(process.env.NEXT_PUBLIC_WS_URL || '', {
      transports: ['websocket'],
    });
    
    socketRef.current = socket;
    
    socket.on('connect', () => {
      setIsConnected(true);
      socket.emit('join-room', roomId);
    });
    
    socket.on('disconnect', () => {
      setIsConnected(false);
    });
    
    return () => {
      socket.disconnect();
    };
  }, [roomId]);
  
  const emit = (event: string, data: any) => {
    socketRef.current?.emit(event, data);
  };
  
  const on = (event: string, callback: (data: any) => void) => {
    socketRef.current?.on(event, callback);
  };
  
  return { isConnected, emit, on };
}
```

---

### AIæ©Ÿèƒ½ã®çµ±åˆ

#### OpenAI APIã®çµ±åˆ

```typescript
// lib/openai.ts
import OpenAI from 'openai';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

// æŠ•ç¨¿ã®è‡ªå‹•è¦ç´„
export async function summarizePost(content: string) {
  const response = await openai.chat.completions.create({
    model: 'gpt-4',
    messages: [
      {
        role: 'system',
        content: 'æŠ•ç¨¿å†…å®¹ã‚’3æ–‡ä»¥å†…ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚',
      },
      {
        role: 'user',
        content,
      },
    ],
    max_tokens: 150,
  });
  
  return response.choices[0].message.content;
}

// ã‚¿ã‚°ã®è‡ªå‹•ç”Ÿæˆ
export async function generateTags(content: string) {
  const response = await openai.chat.completions.create({
    model: 'gpt-4',
    messages: [
      {
        role: 'system',
        content: 'ã“ã®æŠ•ç¨¿ã«é©åˆ‡ãªã‚¿ã‚°ã‚’5ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚JSONé…åˆ—ã§è¿”ã—ã¦ãã ã•ã„ã€‚',
      },
      {
        role: 'user',
        content,
      },
    ],
    response_format: { type: 'json_object' },
  });
  
  const result = JSON.parse(response.choices[0].message.content || '{}');
  return result.tags || [];
}

// ç”»åƒã®èª¬æ˜ç”Ÿæˆ
export async function describeImage(imageUrl: string) {
  const response = await openai.chat.completions.create({
    model: 'gpt-4-vision-preview',
    messages: [
      {
        role: 'user',
        content: [
          { type: 'text', text: 'ã“ã®ç”»åƒã‚’è©³ã—ãèª¬æ˜ã—ã¦ãã ã•ã„ã€‚' },
          { type: 'image_url', image_url: { url: imageUrl } },
        ],
      },
    ],
  });
  
  return response.choices[0].message.content;
}

// ä½¿ç”¨ä¾‹
export function AISummaryButton({ post }: { post: Post }) {
  const [summary, setSummary] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);
  
  const handleSummarize = async () => {
    setLoading(true);
    try {
      const result = await fetch('/api/ai/summarize', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: post.content }),
      });
      const data = await result.json();
      setSummary(data.summary);
    } catch (error) {
      console.error('Failed to summarize:', error);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div>
      <button onClick={handleSummarize} disabled={loading}>
        {loading ? 'ç”Ÿæˆä¸­...' : 'AIè¦ç´„ã‚’ç”Ÿæˆ'}
      </button>
      {summary && (
        <div className="mt-4 p-4 bg-blue-50 rounded">
          <p className="text-sm text-gray-700">{summary}</p>
        </div>
      )}
    </div>
  );
}
```

---

### ãƒ“ãƒ‡ã‚ªä¼šè­°æ©Ÿèƒ½

#### WebRTCã®å®Ÿè£…

```typescript
// lib/webrtc.ts
export class VideoChat {
  private peerConnection: RTCPeerConnection | null = null;
  private localStream: MediaStream | null = null;
  
  async initialize() {
    // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¹ãƒˆãƒªãƒ¼ãƒ ã®å–å¾—
    this.localStream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true,
    });
    
    // RTCPeerConnectionã®ä½œæˆ
    this.peerConnection = new RTCPeerConnection({
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
      ],
    });
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è¿½åŠ 
    this.localStream.getTracks().forEach((track) => {
      this.peerConnection?.addTrack(track, this.localStream!);
    });
    
    return this.localStream;
  }
  
  async createOffer() {
    if (!this.peerConnection) throw new Error('Not initialized');
    
    const offer = await this.peerConnection.createOffer();
    await this.peerConnection.setLocalDescription(offer);
    return offer;
  }
  
  async handleAnswer(answer: RTCSessionDescriptionInit) {
    if (!this.peerConnection) throw new Error('Not initialized');
    await this.peerConnection.setRemoteDescription(answer);
  }
  
  async handleIceCandidate(candidate: RTCIceCandidateInit) {
    if (!this.peerConnection) throw new Error('Not initialized');
    await this.peerConnection.addIceCandidate(candidate);
  }
  
  disconnect() {
    this.localStream?.getTracks().forEach((track) => track.stop());
    this.peerConnection?.close();
  }
}

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨
export function VideoCallRoom({ roomId }: { roomId: string }) {
  const localVideoRef = useRef<HTMLVideoElement>(null);
  const remoteVideoRef = useRef<HTMLVideoElement>(null);
  const [videoChat] = useState(() => new VideoChat());
  const { emit, on } = useWebSocket(roomId);
  
  useEffect(() => {
    const setup = async () => {
      const stream = await videoChat.initialize();
      if (localVideoRef.current) {
        localVideoRef.current.srcObject = stream;
      }
      
      // ã‚ªãƒ•ã‚¡ãƒ¼ã®ä½œæˆã¨é€ä¿¡
      const offer = await videoChat.createOffer();
      emit('video-offer', { roomId, offer });
    };
    
    setup();
    
    // ã‚·ã‚°ãƒŠãƒªãƒ³ã‚°
    on('video-answer', async (data) => {
      await videoChat.handleAnswer(data.answer);
    });
    
    on('ice-candidate', async (data) => {
      await videoChat.handleIceCandidate(data.candidate);
    });
    
    return () => {
      videoChat.disconnect();
    };
  }, [roomId]);
  
  return (
    <div className="grid grid-cols-2 gap-4">
      <div>
        <h3>ã‚ãªãŸ</h3>
        <video ref={localVideoRef} autoPlay muted className="w-full" />
      </div>
      <div>
        <h3>ç›¸æ‰‹</h3>
        <video ref={remoteVideoRef} autoPlay className="w-full" />
      </div>
    </div>
  );
}
```

---

## 36.2 ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®è€ƒæ…®

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

#### èª­ã¿å–ã‚Šãƒ¬ãƒ—ãƒªã‚«

```typescript
// lib/prisma-replicas.ts
import { PrismaClient } from '@prisma/client';

// ãƒã‚¹ã‚¿ãƒ¼ï¼ˆæ›¸ãè¾¼ã¿ç”¨ï¼‰
export const prismaWrite = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_URL,
    },
  },
});

// ãƒ¬ãƒ—ãƒªã‚«ï¼ˆèª­ã¿å–ã‚Šç”¨ï¼‰
export const prismaRead = new PrismaClient({
  datasources: {
    db: {
      url: process.env.DATABASE_READ_REPLICA_URL || process.env.DATABASE_URL,
    },
  },
});

// ä½¿ç”¨ä¾‹
export async function getPosts() {
  // èª­ã¿å–ã‚Šã¯ãƒ¬ãƒ—ãƒªã‚«ã‹ã‚‰
  return prismaRead.post.findMany();
}

export async function createPost(data: CreatePostData) {
  // æ›¸ãè¾¼ã¿ã¯ãƒã‚¹ã‚¿ãƒ¼ã¸
  return prismaWrite.post.create({ data });
}
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

```typescript
// lib/sharding.ts
import { PrismaClient } from '@prisma/client';

const shards = [
  new PrismaClient({ datasources: { db: { url: process.env.DB_SHARD_1 } } }),
  new PrismaClient({ datasources: { db: { url: process.env.DB_SHARD_2 } } }),
  new PrismaClient({ datasources: { db: { url: process.env.DB_SHARD_3 } } }),
];

function getShardForUser(userId: string): PrismaClient {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ãƒãƒƒã‚·ãƒ¥å€¤ã§ã‚·ãƒ£ãƒ¼ãƒ‰ã‚’æ±ºå®š
  const hash = userId.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
  const shardIndex = hash % shards.length;
  return shards[shardIndex];
}

export async function getUserPosts(userId: string) {
  const shard = getShardForUser(userId);
  return shard.post.findMany({
    where: { authorId: userId },
  });
}
```

---

### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

#### Redisã®çµ±åˆ

```typescript
// lib/redis.ts
import { Redis } from '@upstash/redis';

export const redis = new Redis({
  url: process.env.UPSTASH_REDIS_REST_URL!,
  token: process.env.UPSTASH_REDIS_REST_TOKEN!,
});

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ˜ãƒ«ãƒ‘ãƒ¼
export async function cached<T>(
  key: string,
  fetcher: () => Promise<T>,
  ttl = 3600
): Promise<T> {
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
  const cached = await redis.get<T>(key);
  if (cached) {
    return cached;
  }
  
  // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  const data = await fetcher();
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
  await redis.setex(key, ttl, JSON.stringify(data));
  
  return data;
}

// ä½¿ç”¨ä¾‹
export async function getPopularPosts() {
  return cached(
    'popular-posts',
    async () => {
      return prisma.post.findMany({
        take: 10,
        orderBy: { likes: { _count: 'desc' } },
      });
    },
    1800 // 30åˆ†
  );
}

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç„¡åŠ¹åŒ–
export async function invalidatePostCache(postId: string) {
  await redis.del(`post:${postId}`);
  await redis.del('popular-posts');
  await redis.del('recent-posts');
}
```

---

### CDNã®æ´»ç”¨

```typescript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    domains: ['your-cdn.cloudfront.net'],
    loader: 'custom',
    loaderFile: './lib/image-loader.ts',
  },
};

module.exports = nextConfig;

// lib/image-loader.ts
export default function cloudflareLoader({
  src,
  width,
  quality,
}: {
  src: string;
  width: number;
  quality?: number;
}) {
  const params = [`width=${width}`];
  if (quality) {
    params.push(`quality=${quality}`);
  }
  
  return `https://your-cdn.cloudfront.net/${src}?${params.join('&')}`;
}
```

---

## 36.3 ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–

### APIã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// services/gateway/src/index.ts
import express from 'express';
import { createProxyMiddleware } from 'http-proxy-middleware';

const app = express();

// èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
app.use(
  '/api/auth',
  createProxyMiddleware({
    target: 'http://auth-service:3001',
    changeOrigin: true,
  })
);

// æŠ•ç¨¿ã‚µãƒ¼ãƒ“ã‚¹
app.use(
  '/api/posts',
  createProxyMiddleware({
    target: 'http://posts-service:3002',
    changeOrigin: true,
  })
);

// é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹
app.use(
  '/api/notifications',
  createProxyMiddleware({
    target: 'http://notifications-service:3003',
    changeOrigin: true,
  })
);

app.listen(3000, () => {
  console.log('API Gateway running on port 3000');
});
```

### ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```typescript
// lib/event-bus.ts
import { EventEmitter } from 'events';

class EventBus extends EventEmitter {
  publish(event: string, data: any) {
    this.emit(event, data);
    
    // å¤–éƒ¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¸ã®é€ä¿¡ï¼ˆä¾‹: RabbitMQ, AWS SQSï¼‰
    if (process.env.MESSAGE_QUEUE_URL) {
      this.sendToQueue(event, data);
    }
  }
  
  private async sendToQueue(event: string, data: any) {
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã¸ã®é€ä¿¡ãƒ­ã‚¸ãƒƒã‚¯
  }
}

export const eventBus = new EventBus();

// ã‚¤ãƒ™ãƒ³ãƒˆã®ç™ºè¡Œ
eventBus.publish('post.created', {
  postId: '123',
  authorId: 'user-456',
  title: 'New Post',
});

// ã‚¤ãƒ™ãƒ³ãƒˆã®è³¼èª­
eventBus.on('post.created', async (data) => {
  // é€šçŸ¥ã‚’é€ä¿¡
  await sendNotification(data.authorId, 'Your post was published!');
  
  // æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
  await updateSearchIndex(data.postId);
  
  // åˆ†æãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²
  await trackEvent('post_created', data);
});
```

---

## 36.4 æœ€æ–°æŠ€è¡“ã®æ¡ç”¨

### Next.js 15ã®æ–°æ©Ÿèƒ½

```typescript
// Partial Prerendering (PPR)
// next.config.js
export default {
  experimental: {
    ppr: true,
  },
};

// app/posts/[id]/page.tsx
import { Suspense } from 'react';

export const experimental_ppr = true;

export default function PostPage({ params }: { params: { id: string } }) {
  return (
    <div>
      {/* é™çš„éƒ¨åˆ† */}
      <PostHeader id={params.id} />
      
      {/* å‹•çš„éƒ¨åˆ† */}
      <Suspense fallback={<CommentsSkeleton />}>
        <Comments postId={params.id} />
      </Suspense>
    </div>
  );
}
```

### React 19ã®æ–°æ©Ÿèƒ½

```typescript
// Server Components with Actions
// app/actions/post-actions.ts
'use server';

import { revalidatePath } from 'next/cache';

export async function createPost(formData: FormData) {
  const title = formData.get('title') as string;
  const content = formData.get('content') as string;
  
  const post = await prisma.post.create({
    data: { title, content },
  });
  
  revalidatePath('/posts');
  return { success: true, post };
}

// app/posts/new/page.tsx
import { createPost } from '@/app/actions/post-actions';

export default function NewPostPage() {
  return (
    <form action={createPost}>
      <input name="title" required />
      <textarea name="content" required />
      <button type="submit">æŠ•ç¨¿</button>
    </form>
  );
}

// useOptimistic Hook
'use client';

import { useOptimistic } from 'react';

export function LikeButton({ postId, initialLikes }: Props) {
  const [likes, addOptimisticLike] = useOptimistic(
    initialLikes,
    (state, newLike: Like) => [...state, newLike]
  );
  
  async function handleLike() {
    const optimisticLike = { id: 'temp', postId, userId: 'current' };
    addOptimisticLike(optimisticLike);
    
    await fetch(`/api/posts/${postId}/like`, { method: 'POST' });
  }
  
  return (
    <button onClick={handleLike}>
      ğŸ‘ {likes.length}
    </button>
  );
}
```

---

## 36.5 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å¼·åŒ–

### Zero Trust Architecture

```typescript
// middleware.ts - ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œè¨¼
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export async function middleware(request: NextRequest) {
  // 1. èªè¨¼ãƒã‚§ãƒƒã‚¯
  const session = await verifySession(request);
  if (!session && !isPublicPath(request.pathname)) {
    return NextResponse.redirect(new URL('/login', request.url));
  }
  
  // 2. æ¨©é™ãƒã‚§ãƒƒã‚¯
  if (session && !hasPermission(session, request.pathname)) {
    return NextResponse.json({ error: 'Forbidden' }, { status: 403 });
  }
  
  // 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™
  const rateLimitResult = await checkRateLimit(request);
  if (!rateLimitResult.allowed) {
    return NextResponse.json(
      { error: 'Too many requests' },
      { status: 429 }
    );
  }
  
  // 4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ 
  const response = NextResponse.next();
  response.headers.set('X-Content-Type-Options', 'nosniff');
  response.headers.set('X-Frame-Options', 'DENY');
  response.headers.set('X-XSS-Protection', '1; mode=block');
  
  return response;
}
```

### ç›£æŸ»ãƒ­ã‚°ã®å¼·åŒ–

```typescript
// lib/audit-logger.ts
import { prisma } from './prisma';

interface AuditLogEntry {
  action: string;
  resource: string;
  resourceId?: string;
  userId?: string;
  metadata?: Record<string, any>;
  ipAddress?: string;
  userAgent?: string;
}

export async function auditLog(entry: AuditLogEntry) {
  await prisma.auditLog.create({
    data: {
      ...entry,
      timestamp: new Date(),
    },
  });
  
  // é‡è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ã‚¢ãƒ©ãƒ¼ãƒˆ
  if (isCriticalAction(entry.action)) {
    await sendSecurityAlert(entry);
  }
}

// ä½¿ç”¨ä¾‹
await auditLog({
  action: 'user.role.changed',
  resource: 'user',
  resourceId: userId,
  userId: adminId,
  metadata: {
    oldRole: 'member',
    newRole: 'admin',
  },
  ipAddress: request.ip,
  userAgent: request.headers.get('user-agent'),
});
```

---

## 36.6 å›½éš›åŒ–ï¼ˆi18nï¼‰

### next-intlã®çµ±åˆ

```typescript
// i18n/config.ts
export const locales = ['ja', 'en'] as const;
export const defaultLocale = 'ja' as const;

// messages/ja.json
{
  "common": {
    "save": "ä¿å­˜",
    "cancel": "ã‚­ãƒ£ãƒ³ã‚»ãƒ«",
    "delete": "å‰Šé™¤"
  },
  "posts": {
    "title": "æŠ•ç¨¿",
    "create": "æ–°è¦æŠ•ç¨¿",
    "empty": "æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“"
  }
}

// app/[locale]/layout.tsx
import { NextIntlClientProvider } from 'next-intl';
import { notFound } from 'next/navigation';

export default async function LocaleLayout({
  children,
  params: { locale },
}: {
  children: React.ReactNode;
  params: { locale: string };
}) {
  let messages;
  try {
    messages = (await import(`@/messages/${locale}.json`)).default;
  } catch (error) {
    notFound();
  }
  
  return (
    <html lang={locale}>
      <body>
        <NextIntlClientProvider locale={locale} messages={messages}>
          {children}
        </NextIntlClientProvider>
      </body>
    </html>
  );
}

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨
'use client';

import { useTranslations } from 'next-intl';

export function PostList() {
  const t = useTranslations('posts');
  
  return (
    <div>
      <h1>{t('title')}</h1>
      <button>{t('create')}</button>
    </div>
  );
}
```

---

## 36.7 å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹ã¨ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **Next.js**: https://nextjs.org/docs
- **React**: https://react.dev
- **TypeScript**: https://www.typescriptlang.org/docs
- **Tailwind CSS**: https://tailwindcss.com/docs
- **Prisma**: https://www.prisma.io/docs

### ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 

1. **Next.js Learn**: https://nextjs.org/learn
   - å…¬å¼ã®ç„¡æ–™ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
   - åŸºç¤ã‹ã‚‰å®Ÿè·µã¾ã§ç¶²ç¾…

2. **Frontend Masters**: https://frontendmasters.com
   - ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«å‘ã‘ã‚³ãƒ¼ã‚¹
   - Reactã€TypeScriptã€Next.jsãªã©

3. **egghead.io**: https://egghead.io
   - çŸ­æ™‚é–“ã®ãƒ“ãƒ‡ã‚ªãƒ¬ãƒƒã‚¹ãƒ³
   - å®Ÿè·µçš„ãªå†…å®¹

4. **Udemy**: https://www.udemy.com
   - æ—¥æœ¬èªã‚³ãƒ¼ã‚¹å¤šæ•°
   - åˆå¿ƒè€…å‘ã‘ã‹ã‚‰ä¸Šç´šã¾ã§

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£

1. **Discord**
   - Next.js Discord
   - Reactiflux
   - Prisma Community

2. **GitHub Discussions**
   - Next.js: https://github.com/vercel/next.js/discussions
   - React: https://github.com/facebook/react/discussions

3. **Stack Overflow**
   - [next.js] ã‚¿ã‚°
   - [react] ã‚¿ã‚°
   - [typescript] ã‚¿ã‚°

4. **Twitter/X**
   - @nextjs
   - @reactjs
   - @vercel

### ãŠã™ã™ã‚ãƒ–ãƒ­ã‚°

- **Vercel Blog**: https://vercel.com/blog
- **Kent C. Dodds**: https://kentcdodds.com/blog
- **Josh Comeau**: https://www.joshwcomeau.com
- **Robin Wieruch**: https://www.robinwieruch.de/blog

---

## 36.8 æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### çŸ­æœŸç›®æ¨™ï¼ˆ1-3ãƒ¶æœˆï¼‰

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - [ ] Core Web Vitalsã®æ”¹å–„
   - [ ] ç”»åƒæœ€é©åŒ–ã®å¾¹åº•
   - [ ] ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®å‰Šæ¸›

2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹**
   - [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
   - [ ] ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®æ”¹å–„
   - [ ] ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã®å¼·åŒ–

3. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**
   - [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ80%ä»¥ä¸Š
   - [ ] E2Eãƒ†ã‚¹ãƒˆã®å……å®Ÿ
   - [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

### ä¸­æœŸç›®æ¨™ï¼ˆ3-6ãƒ¶æœˆï¼‰

1. **æ©Ÿèƒ½æ‹¡å¼µ**
   - [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆ
   - [ ] é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 
   - [ ] é«˜åº¦ãªæ¤œç´¢æ©Ÿèƒ½

2. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**
   - [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã®å®Ÿè£…
   - [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–
   - [ ] CDNã®æ´»ç”¨

3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
   - [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã®å®Ÿæ–½
   - [ ] è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ã®è‡ªå‹•åŒ–
   - [ ] ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ

### é•·æœŸç›®æ¨™ï¼ˆ6-12ãƒ¶æœˆï¼‰

1. **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åŒ–**
   - [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã®ãƒªãƒªãƒ¼ã‚¹
   - [ ] APIå…¬é–‹
   - [ ] ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£é€£æº

2. **AI/MLçµ±åˆ**
   - [ ] ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - [ ] è‡ªå‹•ã‚¿ã‚°ä»˜ã‘
   - [ ] ã‚¹ãƒ‘ãƒ æ¤œå‡º

3. **ã‚°ãƒ­ãƒ¼ãƒãƒ«å±•é–‹**
   - [ ] å¤šè¨€èªå¯¾å¿œ
   - [ ] åœ°åŸŸæœ€é©åŒ–
   - [ ] ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹å¯¾å¿œ

---

## 36.9 ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã®ã¾ã¨ã‚

### ã‚³ãƒ¼ãƒ‰å“è³ª

```typescript
// âœ… Good: å‹å®‰å…¨ã§æ˜ç¢º
interface User {
  id: string;
  name: string;
  email: string;
}

async function getUser(id: string): Promise<User> {
  return await prisma.user.findUniqueOrThrow({ where: { id } });
}

// âŒ Bad: å‹ãŒä¸æ˜ç¢º
async function getUser(id: any): Promise<any> {
  return await prisma.user.findUnique({ where: { id } });
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

```typescript
// âœ… Good: ãƒ¡ãƒ¢åŒ–ã§ä¸è¦ãªå†è¨ˆç®—ã‚’é˜²ã
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(data);
}, [data]);

// âŒ Bad: æ¯å›è¨ˆç®—ã•ã‚Œã‚‹
const expensiveValue = computeExpensiveValue(data);
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

```typescript
// âœ… Good: å…¥åŠ›ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
const schema = z.object({
  email: z.string().email(),
  password: z.string().min(8),
});

const validated = schema.parse(formData);

// âŒ Bad: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãªã—
const { email, password } = formData;
```

### ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£

```tsx
// âœ… Good: ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯HTMLã¨ARIA
<button
  aria-label="æŠ•ç¨¿ã‚’å‰Šé™¤"
  onClick={handleDelete}
>
  <TrashIcon aria-hidden="true" />
</button>

// âŒ Bad: divã‚’ãƒœã‚¿ãƒ³ã¨ã—ã¦ä½¿ç”¨
<div onClick={handleDelete}>
  <TrashIcon />
</div>
```

---

## ã¾ã¨ã‚

ã“ã®æ•™ç§‘æ›¸ã‚’é€šã˜ã¦ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å­¦ã³ã¾ã—ãŸï¼š

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
- âœ… **Next.js 16**: æœ€æ–°ã®Reactãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- âœ… **TypeScript**: å‹å®‰å…¨ãªé–‹ç™º
- âœ… **Tailwind CSS**: åŠ¹ç‡çš„ãªã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- âœ… **Prisma**: å‹å®‰å…¨ãªORM
- âœ… **NextAuth.js**: èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### é–‹ç™ºã‚¹ã‚­ãƒ«
- âœ… **ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯é–‹ç™º**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¾ã§
- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**: æ­£è¦åŒ–ã¨ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- âœ… **APIè¨­è¨ˆ**: RESTful APIã¨Server Actions
- âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: èªè¨¼ã€èªå¯ã€ãƒ‡ãƒ¼ã‚¿ä¿è­·
- âœ… **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æœ€é©åŒ–ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

### å®Ÿè·µçš„ãªçŸ¥è­˜
- âœ… **ãƒ‡ãƒ—ãƒ­ã‚¤**: Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… **CI/CD**: è‡ªå‹•ãƒ†ã‚¹ãƒˆã¨ãƒ‡ãƒ—ãƒ­ã‚¤
- âœ… **ç›£è¦–**: ãƒ­ã‚°ç®¡ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°
- âœ… **ä¿å®ˆ**: ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨æ›´æ–°

### ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªé–‹ç™º
- âœ… **ã‚³ãƒ¼ãƒ‰å“è³ª**: ESLintã€Prettierã€TypeScript
- âœ… **ãƒ†ã‚¹ãƒˆ**: ãƒ¦ãƒ‹ãƒƒãƒˆã€çµ±åˆã€E2E
- âœ… **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚«ã‚¿ãƒ­ã‚°
- âœ… **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: WCAGæº–æ‹ 

## æœ€å¾Œã«

ã“ã®BOLDè»½éŸ³ãƒ¡ãƒ³ãƒãƒ¼ã‚µã‚¤ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ¢ãƒ€ãƒ³ãªWebé–‹ç™ºã®å®Ÿè·µçš„ãªæ•™æã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚å­¦ã‚“ã çŸ¥è­˜ã‚’æ´»ç”¨ã—ã¦ã€ã‚ãªãŸè‡ªèº«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ§‹ç¯‰ã—ã¦ãã ã•ã„ã€‚

### ç¶™ç¶šçš„ãªå­¦ç¿’

- ğŸ“š å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å®šæœŸçš„ã«ç¢ºèª
- ğŸ—ï¸ å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿé¨“
- ğŸ‘¥ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã«å‚åŠ 
- ğŸ“ å­¦ã‚“ã ã“ã¨ã‚’ãƒ–ãƒ­ã‚°ã«è¨˜éŒ²
- ğŸ¤ ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã«è²¢çŒ®

### æˆåŠŸã¸ã®é“

1. **å°ã•ãå§‹ã‚ã‚‹**: å®Œç’§ã‚’ç›®æŒ‡ã•ãšã€å‹•ãã‚‚ã®ã‚’ä½œã‚‹
2. **åå¾©ã™ã‚‹**: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã¦æ”¹å–„
3. **å…±æœ‰ã™ã‚‹**: å­¦ã³ã‚’ä»–è€…ã¨å…±æœ‰
4. **æ¥½ã—ã‚€**: é–‹ç™ºã‚’æ¥½ã—ã‚€ã“ã¨ãŒæœ€ã‚‚é‡è¦

**Happy Coding! ğŸš€**

---

ã“ã®æ•™ç§‘æ›¸ãŒã‚ãªãŸã®é–‹ç™ºã®æ—…ã®ä¸€åŠ©ã¨ãªã‚Œã°å¹¸ã„ã§ã™ã€‚è³ªå•ã‚„æ”¹å–„æ¡ˆãŒã‚ã‚Œã°ã€GitHubã®Issueã‚„Discussionsã§ãŠæ°—è»½ã«ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚

**è£½ä½œ**: 2025å¹´
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**: MIT

---

[â† å‰ã®ç« ï¼šç¬¬35ç«  ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](35-ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹.md) | [ç›®æ¬¡ã«æˆ»ã‚‹](00-ç›®æ¬¡.md)
