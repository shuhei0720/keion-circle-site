# ç¬¬24ç« ï¼šç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å®Ÿè£…

ã“ã®ç« ã§ã¯ã€ç®¡ç†è€…å°‚ç”¨ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†æ©Ÿèƒ½ã‚’å«ã¿ã¾ã™ã€‚

## 24.1 ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸

### app/admin/page.tsx

```typescript
import { redirect } from 'next/navigation';
import { auth } from '@/lib/auth';
import { prisma } from '@/lib/db';
import StatsCard from '@/components/admin/StatsCard';
import RecentActivities from '@/components/admin/RecentActivities';
import UserManagement from '@/components/admin/UserManagement';
import ContentManagement from '@/components/admin/ContentManagement';
import { Users, FileText, Calendar, MessageCircle, Heart, Crown } from 'lucide-react';

async function getStats() {
  const [
    totalUsers,
    totalPosts,
    totalEvents,
    totalComments,
    totalLikes,
    adminCount,
    recentUsers,
    recentPosts,
    recentComments,
  ] = await Promise.all([
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
    prisma.user.count(),
    
    // æŠ•ç¨¿æ•°
    prisma.post.count(),
    
    // ã‚¤ãƒ™ãƒ³ãƒˆæ•°
    prisma.event.count(),
    
    // ã‚³ãƒ¡ãƒ³ãƒˆæ•°
    prisma.comment.count(),
    
    // ã„ã„ã­æ•°
    prisma.like.count(),
    
    // ç®¡ç†è€…æ•°
    prisma.user.count({ where: { role: 'admin' } }),
    
    // æœ€è¿‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ5äººï¼‰
    prisma.user.findMany({
      take: 5,
      orderBy: { createdAt: 'desc' },
      select: {
        id: true,
        name: true,
        email: true,
        image: true,
        createdAt: true,
        role: true,
      },
    }),
    
    // æœ€è¿‘ã®æŠ•ç¨¿ï¼ˆ5ä»¶ï¼‰
    prisma.post.findMany({
      take: 5,
      orderBy: { createdAt: 'desc' },
      include: {
        author: {
          select: {
            id: true,
            name: true,
            image: true,
          },
        },
        _count: {
          select: {
            likes: true,
            comments: true,
          },
        },
      },
    }),
    
    // æœ€è¿‘ã®ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ5ä»¶ï¼‰
    prisma.comment.findMany({
      take: 5,
      orderBy: { createdAt: 'desc' },
      include: {
        user: {
          select: {
            id: true,
            name: true,
            image: true,
          },
        },
        post: {
          select: {
            id: true,
            title: true,
          },
        },
      },
    }),
  ]);
  
  return {
    totalUsers,
    totalPosts,
    totalEvents,
    totalComments,
    totalLikes,
    adminCount,
    memberCount: totalUsers - adminCount,
    recentUsers,
    recentPosts,
    recentComments,
  };
}

export default async function AdminDashboardPage() {
  const session = await auth();
  
  // ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
  if (!session || session.user.role !== 'admin') {
    redirect('/');
  }
  
  const stats = await getStats();
  
  return (
    <div className="max-w-7xl mx-auto px-4 py-8">
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold flex items-center gap-2 mb-2">
          <Crown className="w-8 h-8 text-yellow-600" />
          ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
        </h1>
        <p className="text-gray-600">
          ã‚µã‚¤ãƒˆå…¨ä½“ã®çµ±è¨ˆæƒ…å ±ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†
        </p>
      </div>
      
      {/* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */}
      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        <StatsCard
          title="ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°"
          value={stats.totalUsers}
          icon={Users}
          color="blue"
          subtitle={`ç®¡ç†è€…: ${stats.adminCount} / ãƒ¡ãƒ³ãƒãƒ¼: ${stats.memberCount}`}
        />
        
        <StatsCard
          title="æŠ•ç¨¿æ•°"
          value={stats.totalPosts}
          icon={FileText}
          color="green"
        />
        
        <StatsCard
          title="ã‚¤ãƒ™ãƒ³ãƒˆæ•°"
          value={stats.totalEvents}
          icon={Calendar}
          color="purple"
        />
        
        <StatsCard
          title="ã‚³ãƒ¡ãƒ³ãƒˆæ•°"
          value={stats.totalComments}
          icon={MessageCircle}
          color="orange"
        />
        
        <StatsCard
          title="ã„ã„ã­æ•°"
          value={stats.totalLikes}
          icon={Heart}
          color="red"
        />
        
        <StatsCard
          title="å¹³å‡ã„ã„ã­/æŠ•ç¨¿"
          value={(stats.totalLikes / (stats.totalPosts || 1)).toFixed(1)}
          icon={Heart}
          color="pink"
        />
      </div>
      
      {/* æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ */}
      <section className="mb-8">
        <RecentActivities
          users={stats.recentUsers}
          posts={stats.recentPosts}
          comments={stats.recentComments}
        />
      </section>
      
      {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† */}
      <section className="mb-8">
        <UserManagement />
      </section>
      
      {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç† */}
      <section>
        <ContentManagement />
      </section>
    </div>
  );
}
```

---

## 24.2 çµ±è¨ˆã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### components/admin/StatsCard.tsx

```typescript
import { LucideIcon } from 'lucide-react';

interface StatsCardProps {
  title: string;
  value: number | string;
  icon: LucideIcon;
  color: 'blue' | 'green' | 'purple' | 'orange' | 'red' | 'pink' | 'yellow';
  subtitle?: string;
}

const colorClasses = {
  blue: 'bg-blue-100 text-blue-600',
  green: 'bg-green-100 text-green-600',
  purple: 'bg-purple-100 text-purple-600',
  orange: 'bg-orange-100 text-orange-600',
  red: 'bg-red-100 text-red-600',
  pink: 'bg-pink-100 text-pink-600',
  yellow: 'bg-yellow-100 text-yellow-600',
};

export default function StatsCard({ title, value, icon: Icon, color, subtitle }: StatsCardProps) {
  return (
    <div className="bg-white border rounded-lg p-6 hover:shadow-lg transition-shadow">
      <div className="flex items-start justify-between mb-4">
        <div className={`p-3 rounded-lg ${colorClasses[color]}`}>
          <Icon className="w-6 h-6" />
        </div>
      </div>
      
      <h3 className="text-sm font-medium text-gray-600 mb-1">{title}</h3>
      <p className="text-3xl font-bold mb-2">{value}</p>
      
      {subtitle && (
        <p className="text-xs text-gray-500">{subtitle}</p>
      )}
    </div>
  );
}
```

---

## 24.3 æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### components/admin/RecentActivities.tsx

```typescript
import Link from 'next/link';
import Image from 'next/image';
import { formatDistanceToNow } from 'date-fns';
import { ja } from 'date-fns/locale';
import { Users, FileText, MessageCircle, Crown } from 'lucide-react';

interface RecentActivitiesProps {
  users: Array<{
    id: string;
    name: string | null;
    email: string;
    image: string | null;
    createdAt: Date;
    role: string;
  }>;
  posts: Array<{
    id: string;
    title: string;
    createdAt: Date;
    author: {
      id: string;
      name: string | null;
      image: string | null;
    };
    _count: {
      likes: number;
      comments: number;
    };
  }>;
  comments: Array<{
    id: string;
    content: string;
    createdAt: Date;
    user: {
      id: string;
      name: string | null;
      image: string | null;
    };
    post: {
      id: string;
      title: string;
    };
  }>;
}

export default function RecentActivities({ users, posts, comments }: RecentActivitiesProps) {
  return (
    <div className="grid lg:grid-cols-3 gap-6">
      {/* æœ€è¿‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ */}
      <div className="bg-white border rounded-lg p-6">
        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
          <Users className="w-5 h-5 text-blue-600" />
          æœ€è¿‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
        </h3>
        
        <div className="space-y-3">
          {users.map(user => (
            <Link
              key={user.id}
              href={`/users/${user.id}`}
              className="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <div className="relative w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
                {user.image ? (
                  <Image
                    src={user.image}
                    alt={user.name || ''}
                    fill
                    className="object-cover"
                  />
                ) : (
                  <div className="w-full h-full flex items-center justify-center text-gray-400 font-bold">
                    {user.name?.[0] || '?'}
                  </div>
                )}
                
                {user.role === 'admin' && (
                  <div className="absolute -bottom-1 -right-1 w-5 h-5 bg-yellow-400 rounded-full flex items-center justify-center border border-white">
                    <Crown className="w-3 h-3 text-yellow-800" />
                  </div>
                )}
              </div>
              
              <div className="flex-1 min-w-0">
                <p className="font-medium text-sm truncate">{user.name}</p>
                <p className="text-xs text-gray-500">
                  {formatDistanceToNow(new Date(user.createdAt), { locale: ja, addSuffix: true })}
                </p>
              </div>
            </Link>
          ))}
        </div>
      </div>
      
      {/* æœ€è¿‘ã®æŠ•ç¨¿ */}
      <div className="bg-white border rounded-lg p-6">
        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
          <FileText className="w-5 h-5 text-green-600" />
          æœ€è¿‘ã®æŠ•ç¨¿
        </h3>
        
        <div className="space-y-3">
          {posts.map(post => (
            <Link
              key={post.id}
              href={`/posts/${post.id}`}
              className="block p-2 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <p className="font-medium text-sm line-clamp-1 mb-1">
                {post.title}
              </p>
              <div className="flex items-center justify-between text-xs text-gray-500">
                <span>{post.author.name}</span>
                <span>
                  â¤ï¸ {post._count.likes} ğŸ’¬ {post._count.comments}
                </span>
              </div>
            </Link>
          ))}
        </div>
      </div>
      
      {/* æœ€è¿‘ã®ã‚³ãƒ¡ãƒ³ãƒˆ */}
      <div className="bg-white border rounded-lg p-6">
        <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
          <MessageCircle className="w-5 h-5 text-orange-600" />
          æœ€è¿‘ã®ã‚³ãƒ¡ãƒ³ãƒˆ
        </h3>
        
        <div className="space-y-3">
          {comments.map(comment => (
            <Link
              key={comment.id}
              href={`/posts/${comment.post.id}#comment-${comment.id}`}
              className="block p-2 rounded-lg hover:bg-gray-50 transition-colors"
            >
              <p className="text-sm line-clamp-2 mb-1">
                {comment.content}
              </p>
              <div className="flex items-center justify-between text-xs text-gray-500">
                <span>{comment.user.name}</span>
                <span>
                  {formatDistanceToNow(new Date(comment.createdAt), { locale: ja, addSuffix: true })}
                </span>
              </div>
            </Link>
          ))}
        </div>
      </div>
    </div>
  );
}
```

---

## 24.4 ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### components/admin/UserManagement.tsx

```typescript
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import Image from 'next/image';
import { Users, Crown, Shield, Trash2, Search } from 'lucide-react';

interface User {
  id: string;
  name: string | null;
  email: string;
  image: string | null;
  role: string;
  _count: {
    posts: number;
    comments: number;
  };
}

export default function UserManagement() {
  const router = useRouter();
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  
  const fetchUsers = async () => {
    try {
      const response = await fetch('/api/admin/users');
      const data = await response.json();
      setUsers(data);
    } catch (error) {
      console.error('Failed to fetch users:', error);
    } finally {
      setLoading(false);
    }
  };
  
  useEffect(() => {
    fetchUsers();
  }, []);
  
  const handleRoleChange = async (userId: string, newRole: string) => {
    if (!confirm(`å½¹å‰²ã‚’ã€Œ${newRole === 'admin' ? 'ç®¡ç†è€…' : 'ãƒ¡ãƒ³ãƒãƒ¼'}ã€ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ`)) {
      return;
    }
    
    try {
      const response = await fetch(`/api/admin/users/${userId}/role`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ role: newRole }),
      });
      
      if (!response.ok) throw new Error();
      
      await fetchUsers();
      router.refresh();
    } catch (error) {
      alert('å½¹å‰²ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };
  
  const handleDeleteUser = async (userId: string, userName: string | null) => {
    if (!confirm(`${userName} ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
      return;
    }
    
    try {
      const response = await fetch(`/api/admin/users/${userId}`, {
        method: 'DELETE',
      });
      
      if (!response.ok) throw new Error();
      
      await fetchUsers();
      router.refresh();
    } catch (error) {
      alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };
  
  const filteredUsers = users.filter(user =>
    user.name?.toLowerCase().includes(searchQuery.toLowerCase()) ||
    user.email.toLowerCase().includes(searchQuery.toLowerCase())
  );
  
  return (
    <div className="bg-white border rounded-lg p-6">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-2xl font-bold flex items-center gap-2">
          <Users className="w-6 h-6" />
          ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
        </h2>
        
        <div className="relative">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
          <input
            type="text"
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢..."
            className="pl-10 pr-4 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
      </div>
      
      {loading ? (
        <p className="text-center text-gray-600 py-8">èª­ã¿è¾¼ã¿ä¸­...</p>
      ) : (
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b">
                <th className="text-left py-3 px-4">ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                <th className="text-left py-3 px-4">ãƒ¡ãƒ¼ãƒ«</th>
                <th className="text-center py-3 px-4">å½¹å‰²</th>
                <th className="text-center py-3 px-4">æŠ•ç¨¿</th>
                <th className="text-center py-3 px-4">ã‚³ãƒ¡ãƒ³ãƒˆ</th>
                <th className="text-center py-3 px-4">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              {filteredUsers.map(user => (
                <tr key={user.id} className="border-b hover:bg-gray-50">
                  <td className="py-3 px-4">
                    <div className="flex items-center gap-3">
                      <div className="relative w-10 h-10 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
                        {user.image ? (
                          <Image
                            src={user.image}
                            alt={user.name || ''}
                            fill
                            className="object-cover"
                          />
                        ) : (
                          <div className="w-full h-full flex items-center justify-center text-gray-400 font-bold">
                            {user.name?.[0] || '?'}
                          </div>
                        )}
                      </div>
                      <span className="font-medium">{user.name}</span>
                    </div>
                  </td>
                  
                  <td className="py-3 px-4 text-sm text-gray-600">
                    {user.email}
                  </td>
                  
                  <td className="py-3 px-4 text-center">
                    <select
                      value={user.role}
                      onChange={(e) => handleRoleChange(user.id, e.target.value)}
                      className={`px-3 py-1 rounded-full text-sm font-medium border ${
                        user.role === 'admin'
                          ? 'bg-yellow-100 text-yellow-800 border-yellow-300'
                          : 'bg-blue-100 text-blue-800 border-blue-300'
                      }`}
                    >
                      <option value="member">ãƒ¡ãƒ³ãƒãƒ¼</option>
                      <option value="admin">ç®¡ç†è€…</option>
                    </select>
                  </td>
                  
                  <td className="py-3 px-4 text-center">
                    {user._count.posts}
                  </td>
                  
                  <td className="py-3 px-4 text-center">
                    {user._count.comments}
                  </td>
                  
                  <td className="py-3 px-4 text-center">
                    <button
                      onClick={() => handleDeleteUser(user.id, user.name)}
                      className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                      title="å‰Šé™¤"
                    >
                      <Trash2 className="w-4 h-4" />
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
          
          {filteredUsers.length === 0 && (
            <p className="text-center text-gray-600 py-8">
              ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ
            </p>
          )}
        </div>
      )}
    </div>
  );
}
```

---

## 24.5 ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### components/admin/ContentManagement.tsx

```typescript
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { FileText, Trash2, Edit, Eye, Search } from 'lucide-react';
import { format } from 'date-fns';
import { ja } from 'date-fns/locale';

interface Post {
  id: string;
  title: string;
  content: string;
  createdAt: Date;
  author: {
    id: string;
    name: string | null;
  };
  _count: {
    likes: number;
    comments: number;
  };
}

export default function ContentManagement() {
  const router = useRouter();
  const [posts, setPosts] = useState<Post[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');
  
  const fetchPosts = async () => {
    try {
      const response = await fetch('/api/admin/posts');
      const data = await response.json();
      setPosts(data);
    } catch (error) {
      console.error('Failed to fetch posts:', error);
    } finally {
      setLoading(false);
    }
  };
  
  useEffect(() => {
    fetchPosts();
  }, []);
  
  const handleDeletePost = async (postId: string, postTitle: string) => {
    if (!confirm(`ã€Œ${postTitle}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
      return;
    }
    
    try {
      const response = await fetch(`/api/posts/${postId}`, {
        method: 'DELETE',
      });
      
      if (!response.ok) throw new Error();
      
      await fetchPosts();
      router.refresh();
    } catch (error) {
      alert('æŠ•ç¨¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
  };
  
  const filteredPosts = posts.filter(post =>
    post.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
    post.content.toLowerCase().includes(searchQuery.toLowerCase()) ||
    post.author.name?.toLowerCase().includes(searchQuery.toLowerCase())
  );
  
  return (
    <div className="bg-white border rounded-lg p-6">
      <div className="flex items-center justify-between mb-6">
        <h2 className="text-2xl font-bold flex items-center gap-2">
          <FileText className="w-6 h-6" />
          ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†
        </h2>
        
        <div className="flex items-center gap-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400" />
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="æŠ•ç¨¿ã‚’æ¤œç´¢..."
              className="pl-10 pr-4 py-2 border rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          
          <Link
            href="/posts/new"
            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium"
          >
            + æ–°è¦æŠ•ç¨¿
          </Link>
        </div>
      </div>
      
      {loading ? (
        <p className="text-center text-gray-600 py-8">èª­ã¿è¾¼ã¿ä¸­...</p>
      ) : (
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b">
                <th className="text-left py-3 px-4">ã‚¿ã‚¤ãƒˆãƒ«</th>
                <th className="text-left py-3 px-4">æŠ•ç¨¿è€…</th>
                <th className="text-center py-3 px-4">ä½œæˆæ—¥</th>
                <th className="text-center py-3 px-4">ã„ã„ã­</th>
                <th className="text-center py-3 px-4">ã‚³ãƒ¡ãƒ³ãƒˆ</th>
                <th className="text-center py-3 px-4">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              {filteredPosts.map(post => (
                <tr key={post.id} className="border-b hover:bg-gray-50">
                  <td className="py-3 px-4">
                    <p className="font-medium line-clamp-1">{post.title}</p>
                    <p className="text-sm text-gray-600 line-clamp-1">
                      {post.content}
                    </p>
                  </td>
                  
                  <td className="py-3 px-4">
                    <Link
                      href={`/users/${post.author.id}`}
                      className="text-blue-600 hover:underline"
                    >
                      {post.author.name}
                    </Link>
                  </td>
                  
                  <td className="py-3 px-4 text-center text-sm text-gray-600">
                    {format(new Date(post.createdAt), 'yyyy/MM/dd', { locale: ja })}
                  </td>
                  
                  <td className="py-3 px-4 text-center">
                    â¤ï¸ {post._count.likes}
                  </td>
                  
                  <td className="py-3 px-4 text-center">
                    ğŸ’¬ {post._count.comments}
                  </td>
                  
                  <td className="py-3 px-4">
                    <div className="flex items-center justify-center gap-2">
                      <Link
                        href={`/posts/${post.id}`}
                        className="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors"
                        title="è¡¨ç¤º"
                      >
                        <Eye className="w-4 h-4" />
                      </Link>
                      
                      <Link
                        href={`/posts/${post.id}/edit`}
                        className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                        title="ç·¨é›†"
                      >
                        <Edit className="w-4 h-4" />
                      </Link>
                      
                      <button
                        onClick={() => handleDeletePost(post.id, post.title)}
                        className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                        title="å‰Šé™¤"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
          
          {filteredPosts.length === 0 && (
            <p className="text-center text-gray-600 py-8">
              æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ
            </p>
          )}
        </div>
      )}
    </div>
  );
}
```

---

## 24.6 ç®¡ç†è€…ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼API

### app/api/admin/users/route.ts

```typescript
import { NextResponse } from 'next/server';
import { auth } from '@/lib/auth';
import { prisma } from '@/lib/db';

export async function GET() {
  try {
    const session = await auth();
    
    // ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    if (!session || session.user.role !== 'admin') {
      return NextResponse.json(
        { error: 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“' },
        { status: 403 }
      );
    }
    
    const users = await prisma.user.findMany({
      select: {
        id: true,
        name: true,
        email: true,
        image: true,
        role: true,
        createdAt: true,
        _count: {
          select: {
            posts: true,
            comments: true,
          },
        },
      },
      orderBy: {
        createdAt: 'desc',
      },
    });
    
    return NextResponse.json(users);
  } catch (error) {
    console.error('Get users error:', error);
    return NextResponse.json(
      { error: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ' },
      { status: 500 }
    );
  }
}
```

---

## 24.7 å½¹å‰²å¤‰æ›´API

### app/api/admin/users/[id]/role/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { auth } from '@/lib/auth';
import { prisma } from '@/lib/db';

interface RouteContext {
  params: Promise<{ id: string }>;
}

export async function PUT(
  request: NextRequest,
  context: RouteContext
) {
  try {
    const session = await auth();
    
    if (!session || session.user.role !== 'admin') {
      return NextResponse.json(
        { error: 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“' },
        { status: 403 }
      );
    }
    
    const { id } = await context.params;
    const { role } = await request.json();
    
    if (!['admin', 'member'].includes(role)) {
      return NextResponse.json(
        { error: 'ç„¡åŠ¹ãªå½¹å‰²ã§ã™' },
        { status: 400 }
      );
    }
    
    // è‡ªåˆ†è‡ªèº«ã®å½¹å‰²ã¯å¤‰æ›´ã§ããªã„
    if (id === session.user.id) {
      return NextResponse.json(
        { error: 'è‡ªåˆ†è‡ªèº«ã®å½¹å‰²ã¯å¤‰æ›´ã§ãã¾ã›ã‚“' },
        { status: 400 }
      );
    }
    
    const user = await prisma.user.update({
      where: { id },
      data: { role },
      select: {
        id: true,
        name: true,
        role: true,
      },
    });
    
    return NextResponse.json(user);
  } catch (error) {
    console.error('Update role error:', error);
    return NextResponse.json(
      { error: 'å½¹å‰²ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ' },
      { status: 500 }
    );
  }
}
```

---

## 24.8 ç®¡ç†è€…ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤API

### app/api/admin/users/[id]/route.ts

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { auth } from '@/lib/auth';
import { prisma } from '@/lib/db';

interface RouteContext {
  params: Promise<{ id: string }>;
}

export async function DELETE(
  request: NextRequest,
  context: RouteContext
) {
  try {
    const session = await auth();
    
    if (!session || session.user.role !== 'admin') {
      return NextResponse.json(
        { error: 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“' },
        { status: 403 }
      );
    }
    
    const { id } = await context.params;
    
    // è‡ªåˆ†è‡ªèº«ã¯å‰Šé™¤ã§ããªã„
    if (id === session.user.id) {
      return NextResponse.json(
        { error: 'è‡ªåˆ†è‡ªèº«ã¯å‰Šé™¤ã§ãã¾ã›ã‚“' },
        { status: 400 }
      );
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ï¼ˆã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ã§é–¢é€£ãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤ï¼‰
    await prisma.user.delete({
      where: { id },
    });
    
    return NextResponse.json(
      { message: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ' },
      { status: 200 }
    );
  } catch (error) {
    console.error('Delete user error:', error);
    return NextResponse.json(
      { error: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ' },
      { status: 500 }
    );
  }
}
```

---

## 24.9 ç®¡ç†è€…ç”¨æŠ•ç¨¿ä¸€è¦§API

### app/api/admin/posts/route.ts

```typescript
import { NextResponse } from 'next/server';
import { auth } from '@/lib/auth';
import { prisma } from '@/lib/db';

export async function GET() {
  try {
    const session = await auth();
    
    if (!session || session.user.role !== 'admin') {
      return NextResponse.json(
        { error: 'æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“' },
        { status: 403 }
      );
    }
    
    const posts = await prisma.post.findMany({
      include: {
        author: {
          select: {
            id: true,
            name: true,
            image: true,
          },
        },
        _count: {
          select: {
            likes: true,
            comments: true,
          },
        },
      },
      orderBy: {
        createdAt: 'desc',
      },
    });
    
    return NextResponse.json(posts);
  } catch (error) {
    console.error('Get posts error:', error);
    return NextResponse.json(
      { error: 'æŠ•ç¨¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ' },
      { status: 500 }
    );
  }
}
```

---

## 24.10 ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ 

### components/Header.tsxï¼ˆæ‹¡å¼µç‰ˆï¼‰

æ—¢å­˜ã® Header ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```typescript
// æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã«ä»¥ä¸‹ã‚’è¿½åŠ 

import { Crown } from 'lucide-react';

// ã‚»ãƒƒã‚·ãƒ§ãƒ³éƒ¨åˆ†ã«ç®¡ç†è€…ãƒªãƒ³ã‚¯ã‚’è¿½åŠ 
{session.user.role === 'admin' && (
  <Link
    href="/admin"
    className="hidden md:flex items-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-800 rounded-lg hover:bg-yellow-200 transition-colors font-medium"
  >
    <Crown className="w-4 h-4" />
    ç®¡ç†è€…
  </Link>
)}

// ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã‚‚è¿½åŠ 
{session.user.role === 'admin' && (
  <Link
    href="/admin"
    onClick={() => setMobileMenuOpen(false)}
    className="block px-4 py-2 hover:bg-gray-100 rounded-lg flex items-center gap-2 text-yellow-800 bg-yellow-50"
  >
    <Crown className="w-5 h-5" />
    ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  </Link>
)}
```

---

## ã¾ã¨ã‚

ã“ã®ç« ã§ã¯ã€ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®å®Ÿè£…ã«ã¤ã„ã¦å­¦ã³ã¾ã—ãŸï¼š

### çµ±è¨ˆæƒ…å ±
- âœ… **StatsCard**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã€æŠ•ç¨¿æ•°ã€ã‚¤ãƒ™ãƒ³ãƒˆæ•°ãªã©ã‚’è¡¨ç¤º
- âœ… **ã‚«ãƒ©ãƒ¼ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³**: çµ±è¨ˆã®ç¨®é¡ã”ã¨ã«è‰²åˆ†ã‘
- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨ˆç®—**: å¹³å‡ã„ã„ã­æ•°ãªã©ã®è‡ªå‹•è¨ˆç®—

### æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
- âœ… **æœ€è¿‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼**: æ–°è¦ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¡¨ç¤º
- âœ… **æœ€è¿‘ã®æŠ•ç¨¿**: æœ€æ–°ã®æŠ•ç¨¿ä¸€è¦§
- âœ… **æœ€è¿‘ã®ã‚³ãƒ¡ãƒ³ãƒˆ**: æœ€æ–°ã®ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§
- âœ… **ç›¸å¯¾æ™‚åˆ»è¡¨ç¤º**: date-fns ã§æ™‚é–“ã‚’è¡¨ç¤º

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§**: å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤º
- âœ… **å½¹å‰²å¤‰æ›´**: ç®¡ç†è€…/ãƒ¡ãƒ³ãƒãƒ¼ã®åˆ‡ã‚Šæ›¿ãˆ
- âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å‰Šé™¤
- âœ… **æ¤œç´¢æ©Ÿèƒ½**: åå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ã§æ¤œç´¢

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†
- âœ… **æŠ•ç¨¿ä¸€è¦§**: å…¨æŠ•ç¨¿ã®ç®¡ç†ç”»é¢
- âœ… **ä¸€æ‹¬æ“ä½œ**: è¡¨ç¤ºãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- âœ… **æ¤œç´¢æ©Ÿèƒ½**: ã‚¿ã‚¤ãƒˆãƒ«ãƒ»å†…å®¹ãƒ»æŠ•ç¨¿è€…ã§æ¤œç´¢
- âœ… **çµ±è¨ˆè¡¨ç¤º**: ã„ã„ã­æ•°ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆæ•°

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- âœ… **æ¨©é™ãƒã‚§ãƒƒã‚¯**: ç®¡ç†è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- âœ… **è‡ªå·±ä¿è­·**: è‡ªåˆ†è‡ªèº«ã®å½¹å‰²å¤‰æ›´ãƒ»å‰Šé™¤ã‚’é˜²æ­¢
- âœ… **ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°**: é‡è¦ãªæ“ä½œã«ã¯ç¢ºèª

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- âœ… **GET /api/admin/users**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
- âœ… **PUT /api/admin/users/[id]/role**: å½¹å‰²å¤‰æ›´
- âœ… **DELETE /api/admin/users/[id]**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
- âœ… **GET /api/admin/posts**: æŠ•ç¨¿ä¸€è¦§å–å¾—

æ¬¡ã®ç« ã§ã¯ã€**å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°**ã«ã¤ã„ã¦è©³ã—ãè¦‹ã¦ã„ãã¾ã™ã€‚

---

[â† å‰ã®ç« ï¼šç¬¬23ç«  èªè¨¼ãƒšãƒ¼ã‚¸ã®å®Ÿè£…](23-èªè¨¼ãƒšãƒ¼ã‚¸ã®å®Ÿè£….md) | [ç›®æ¬¡ã«æˆ»ã‚‹](00-ç›®æ¬¡.md) | [æ¬¡ã®ç« ã¸ï¼šç¬¬25ç«  å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£… â†’](25-å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£….md)
