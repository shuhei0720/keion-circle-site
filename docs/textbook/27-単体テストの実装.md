# ç¬¬27ç« ï¼šå˜ä½“ãƒ†ã‚¹ãƒˆã®å®Ÿè£…ã€ãƒãƒ³ã‚ºã‚ªãƒ³ã€‘

> **ã“ã®ç« ã§ã¯ã€å®Ÿéš›ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–¢æ•°ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å˜ä½“ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã¾ã™**

## ğŸ› ï¸ **ãƒãƒ³ã‚ºã‚ªãƒ³ä½œæ¥­**

**âš ï¸ é‡è¦**: ã“ã®ç« ã§ã¯å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã€ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’**ã™ã¹ã¦**å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š

> ğŸ’¡ **å‰æ**: ç¬¬26ç« ã€Œãƒ†ã‚¹ãƒˆç’°å¢ƒã®åŸºç¤ã€ã§Jestã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ğŸ“š ã“ã®ç« ã§å­¦ã¶ã“ã¨

- âœ… ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ
- âœ… Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
- âœ… ãƒ¢ãƒƒã‚¯ã®ä½¿ã„æ–¹
- âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

---

## 27.1 ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

### Step 1: ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ä»¥ä¸‹ã®æ§‹é€ ã§ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ï¼š

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ utils.ts
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ utils.test.ts          â† ä½œæˆ
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LikeButton.tsx
â”‚   â””â”€â”€ __tests__/
â”‚       â””â”€â”€ LikeButton.test.tsx    â† ä½œæˆ
```

---

## 27.2 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

### Step 2: `src/lib/__tests__` ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```bash
mkdir -p src/lib/__tests__
```

### Step 3: `src/lib/__tests__/utils.test.ts` ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’**ã™ã¹ã¦**å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›

```typescript
import { formatDate, truncateText, getYouTubeId, validateEmail } from '../utils';

describe('formatDate', () => {
  it('Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ YYYY-MM-DD å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ', () => {
    const date = new Date('2025-12-28T10:00:00Z');
    expect(formatDate(date)).toBe('2025-12-28');
  });

  it('æ–‡å­—åˆ—ã®æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ', () => {
    expect(formatDate('2025-12-28')).toBe('2025-12-28');
  });

  it('nullã®å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™', () => {
    expect(formatDate(null)).toBe('');
  });

  it('ä¸æ­£ãªæ—¥ä»˜ã¯ç©ºæ–‡å­—ã‚’è¿”ã™', () => {
    const result = formatDate('invalid-date');
    expect(result).toBe('');
  });
});

describe('truncateText', () => {
  it('é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šè©°ã‚ã‚‹', () => {
    const text = 'ã“ã‚Œã¯ã¨ã¦ã‚‚é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã§ã™';
    expect(truncateText(text, 10)).toBe('ã“ã‚Œã¯ã¨ã¦ã‚‚é•·ã„...');
  });

  it('çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆã¯ãã®ã¾ã¾è¿”ã™', () => {
    expect(truncateText('çŸ­ã„', 10)).toBe('çŸ­ã„');
  });

  it('ç©ºæ–‡å­—ã®å ´åˆ', () => {
    expect(truncateText('', 10)).toBe('');
  });

  it('æœ€å¤§é•·ã¨åŒã˜å ´åˆã¯...ã‚’ä»˜ã‘ãªã„', () => {
    expect(truncateText('1234567890', 10)).toBe('1234567890');
  });
});

describe('getYouTubeId', () => {
  it('watch URLã‹ã‚‰IDã‚’æŠ½å‡º', () => {
    const url = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
    expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
  });

  it('çŸ­ç¸®URLã‹ã‚‰IDã‚’æŠ½å‡º', () => {
    const url = 'https://youtu.be/dQw4w9WgXcQ';
    expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
  });

  it('embed URLã‹ã‚‰IDã‚’æŠ½å‡º', () => {
    const url = 'https://www.youtube.com/embed/dQw4w9WgXcQ';
    expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
  });

  it('shorts URLã‹ã‚‰IDã‚’æŠ½å‡º', () => {
    const url = 'https://www.youtube.com/shorts/dQw4w9WgXcQ';
    expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
  });

  it('ä¸æ­£ãªURLã®å ´åˆã¯null', () => {
    expect(getYouTubeId('https://example.com')).toBeNull();
  });
});

describe('validateEmail', () => {
  it('æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', () => {
    expect(validateEmail('user@example.com')).toBe(true);
  });

  it('@ãŒãªã„å ´åˆã¯false', () => {
    expect(validateEmail('userexample.com')).toBe(false);
  });

  it('ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒãªã„å ´åˆã¯false', () => {
    expect(validateEmail('user@')).toBe(false);
  });

  it('ç©ºæ–‡å­—ã®å ´åˆã¯false', () => {
    expect(validateEmail('')).toBe(false);
  });

  it('ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€å ´åˆã¯false', () => {
    expect(validateEmail('user @example.com')).toBe(false);
  });
});
```

### Step 4: ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
npm test
```

**æœŸå¾…ã•ã‚Œã‚‹çµæœ:**

```
 PASS  src/lib/__tests__/utils.test.ts
  formatDate
    âœ“ Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ YYYY-MM-DD å½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (3 ms)
    âœ“ æ–‡å­—åˆ—ã®æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (1 ms)
    âœ“ nullã®å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™
    âœ“ ä¸æ­£ãªæ—¥ä»˜ã¯ç©ºæ–‡å­—ã‚’è¿”ã™ (1 ms)
  truncateText
    âœ“ é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šè©°ã‚ã‚‹ (1 ms)
    âœ“ çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆã¯ãã®ã¾ã¾è¿”ã™
    ...

Tests: 17 passed, 17 total
```

---

## 27.3 Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

### Step 5: `src/components/__tests__` ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ

```bash
mkdir -p src/components/__tests__
```

### Step 6: `src/components/__tests__/LikeButton.test.tsx` ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’**ã™ã¹ã¦**å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›

```typescript
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { LikeButton } from '../LikeButton';

// fetch APIã‚’ãƒ¢ãƒƒã‚¯
global.fetch = jest.fn();

describe('LikeButton', () => {
  beforeEach(() => {
    // å„ãƒ†ã‚¹ãƒˆå‰ã«ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
    (global.fetch as jest.Mock).mockReset();
  });

  it('åˆæœŸçŠ¶æ…‹ã§ã€Œã„ã„ã­ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<LikeButton postId="1" initialLiked={false} initialCount={0} />);
    
    const button = screen.getByRole('button');
    expect(button).toBeInTheDocument();
    expect(button).toHaveTextContent('0');
  });

  it('æ—¢ã«ã„ã„ã­æ¸ˆã¿ã®å ´åˆã€ãƒãƒ¼ãƒˆãŒå¡—ã‚Šã¤ã¶ã•ã‚Œã‚‹', () => {
    render(<LikeButton postId="1" initialLiked={true} initialCount={5} />);
    
    const button = screen.getByRole('button');
    expect(button).toHaveTextContent('5');
    // SVGã®fillãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ç¢ºèªï¼ˆå®Ÿè£…ã«å¿œã˜ã¦èª¿æ•´ï¼‰
  });

  it('ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã„ã„ã­ãŒè¿½åŠ ã•ã‚Œã‚‹', async () => {
    (global.fetch as jest.Mock).mockResolvedValueOnce({
      ok: true,
      json: async () => ({ liked: true, count: 1 }),
    });

    render(<LikeButton postId="1" initialLiked={false} initialCount={0} />);
    
    const button = screen.getByRole('button');
    fireEvent.click(button);

    // æ¥½è¦³çš„UIã§å³åº§ã«æ›´æ–°ã•ã‚Œã‚‹
    expect(button).toHaveTextContent('1');

    // APIãŒå‘¼ã°ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
    await waitFor(() => {
      expect(global.fetch).toHaveBeenCalledWith(
        '/api/posts/1/like',
        expect.objectContaining({
          method: 'POST',
        })
      );
    });
  });

  it('ã„ã„ã­æ¸ˆã¿ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã„ã„ã­ãŒè§£é™¤ã•ã‚Œã‚‹', async () => {
    (global.fetch as jest.Mock).mockResolvedValueOnce({
      ok: true,
      json: async () => ({ liked: false, count: 0 }),
    });

    render(<LikeButton postId="1" initialLiked={true} initialCount=1} />);
    
    const button = screen.getByRole('button');
    fireEvent.click(button);

    // æ¥½è¦³çš„UIã§å³åº§ã«æ›´æ–°ã•ã‚Œã‚‹
    expect(button).toHaveTextContent('0');

    await waitFor(() => {
      expect(global.fetch).toHaveBeenCalledWith(
        '/api/posts/1/unlike',
        expect.objectContaining({
          method: 'POST',
        })
      );
    });
  });

  it('APIã‚¨ãƒ©ãƒ¼æ™‚ã¯å…ƒã®çŠ¶æ…‹ã«æˆ»ã‚‹', async () => {
    (global.fetch as jest.Mock).mockRejectedValueOnce(new Error('API Error'));

    render(<LikeButton postId="1" initialLiked={false} initialCount={0} />);
    
    const button = screen.getByRole('button');
    fireEvent.click(button);

    // ä¸€åº¦ã¯å¢—ãˆã‚‹ï¼ˆæ¥½è¦³çš„UIï¼‰
    expect(button).toHaveTextContent('1');

    // ã‚¨ãƒ©ãƒ¼å¾Œã¯å…ƒã«æˆ»ã‚‹
    await waitFor(() => {
      expect(button).toHaveTextContent('0');
    });
  });
});
```

### Step 7: ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
npm test
```

---

## 27.4 ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

### Step 8: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ

```bash
npm run test:coverage
```

**å‡ºåŠ›ä¾‹:**

```
 PASS  src/lib/__tests__/utils.test.ts
 PASS  src/components/__tests__/LikeButton.test.tsx

-------------------|---------|----------|---------|---------|
File               | % Stmts | % Branch | % Funcs | % Lines |
-------------------|---------|----------|---------|---------|
All files          |   85.23 |    78.45 |   88.12 |   86.34 |
 lib/utils.ts      |   95.12 |    90.23 |   100   |   94.87 |
 components/       |   78.45 |    65.34 |   80.12 |   79.23 |
-------------------|---------|----------|---------|---------|
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä½ã„å ´åˆ

**ã©ã®è¡ŒãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª:**

```bash
# coverage/lcov-report/index.html ã‚’é–‹ã
open coverage/lcov-report/index.html
```

---

## 27.5 ãã®ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

### Step 9: YouTubeEmbedã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

`src/components/__tests__/YouTubeEmbed.test.tsx` ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’**ã™ã¹ã¦**å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š

ä»¥ä¸‹ã‚’**ã™ã¹ã¦**å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š

```typescript
import { render, screen } from '@testing-library/react';
import { YouTubeEmbed } from '../YouTubeEmbed';

describe('YouTubeEmbed', () => {
  it('YouTubeå‹•ç”»ã®iframeãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<YouTubeEmbed url="https://www.youtube.com/watch?v=dQw4w9WgXcQ" />);
    
    const iframe = screen.getByTitle('YouTube video player');
    expect(iframe).toBeInTheDocument();
    expect(iframe).toHaveAttribute('src', expect.stringContaining('dQw4w9WgXcQ'));
  });

  it('ä¸æ­£ãªURLã®å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„', () => {
    const { container } = render(<YouTubeEmbed url="https://example.com" />);
    
    const iframe = container.querySelector('iframe');
    expect(iframe).toBeNull();
  });

  it('çŸ­ç¸®URLã§ã‚‚æ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<YouTubeEmbed url="https://youtu.be/dQw4w9WgXcQ" />);
    
    const iframe = screen.getByTitle('YouTube video player');
    expect(iframe).toHaveAttribute('src', expect.stringContaining('dQw4w9WgXcQ'));
  });
});
```

---

## 27.6 ã¾ã¨ã‚

ã“ã®ç« ã§å®Ÿè£…ã—ãŸãƒ†ã‚¹ãƒˆï¼š

1. **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°**: formatDate, truncateText, getYouTubeId, validateEmail
2. **Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: LikeButton, YouTubeEmbed
3. **ãƒ¢ãƒƒã‚¯ã®ä½¿ç”¨**: fetch APIã®ãƒ¢ãƒƒã‚¯
4. **ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š**: ãƒ†ã‚¹ãƒˆç¯„å›²ã®ç¢ºèª

æ¬¡ç« ã§ã¯ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„APIã‚’çµ„ã¿åˆã‚ã›ãŸçµåˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã¾ã™ã€‚

---

## ğŸ’¡ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹å ´åˆ:**

1. **src/lib/utils.ts ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª**
   ```bash
   ls src/lib/utils.ts
   ```

2. **Jestã®è¨­å®šãŒæ­£ã—ã„ã‹ç¢ºèª**
   ```bash
   cat jest.config.js
   ```

3. **ãƒ†ã‚¹ãƒˆã‚’1ã¤ãšã¤å®Ÿè¡Œ**
   ```bash
   npm test -- utils.test.ts
   ```

4. **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã‚€**
   ```
   Expected: "2025-12-28"
   Received: ""
   
   â†’ formatDateé–¢æ•°ã®å®Ÿè£…ã‚’ç¢ºèª
   ```

            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ†ã‚¹ãƒˆ2: Button.test.tsx                â”‚
â”‚   â†’ ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒãƒ£ãƒ¼ãŒä½¿ãˆã‚‹ âœ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ†ã‚¹ãƒˆ3: api.test.ts                    â”‚
â”‚   â†’ ã™ã¹ã¦ã®è¨­å®šãŒé©ç”¨æ¸ˆã¿ âœ“            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **åˆå¿ƒè€…ã¸ã®è£œè¶³:**
> - **`process.env`**: Node.js ã§ç’°å¢ƒå¤‰æ•°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•
> - **ç’°å¢ƒå¤‰æ•°**: ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤–éƒ¨ã‹ã‚‰è¨­å®šã™ã‚‹å€¤ï¼ˆAPI ã‚­ãƒ¼ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ URL ãªã©ï¼‰
> - **ãƒ¢ãƒƒã‚¯**: ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ãƒ»ãƒ€ãƒŸãƒ¼é–¢æ•°
> 
> **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°:**
> - ç’°å¢ƒå¤‰æ•°ãŒåæ˜ ã•ã‚Œãªã„ â†’ Jest ã‚’å†èµ·å‹•ï¼ˆ`npm run test:watch` ã‚’å†å®Ÿè¡Œï¼‰
> - ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒãƒ£ãƒ¼ãŒä½¿ãˆãªã„ â†’ `jest.setup.js` ã®ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª

### package.json ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ 

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:ci": "jest --ci --coverage --maxWorkers=2"
  }
}
```

**å„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª¬æ˜:**

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ | ä½¿ç”¨å ´é¢ |
|---------|------|---------|
| `npm run test` | ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’1å›å®Ÿè¡Œ | æœ¬ç•ªå‰ã®æœ€çµ‚ç¢ºèª |
| `npm run test:watch` | ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã¦è‡ªå‹•å®Ÿè¡Œ | é–‹ç™ºä¸­ï¼ˆãŠã™ã™ã‚ï¼‰ |
| `npm run test:coverage` | ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ãã§å®Ÿè¡Œ | ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª |
| `npm run test:ci` | CI/CD ç”¨ï¼ˆä¸¦åˆ—å®Ÿè¡Œã‚’åˆ¶é™ï¼‰ | GitHub Actions ãªã© |

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è©³ç´°:**

```bash
# --watch: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–
jest --watch
# â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã™ã‚‹ã¨è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆå†å®Ÿè¡Œ

# --coverage: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
jest --coverage
# â†’ coverage/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’å‡ºåŠ›

# --ci: CIç’°å¢ƒç”¨ã®è¨­å®š
jest --ci
# â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç„¡åŠ¹åŒ–ã€ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’éè¡¨ç¤º

# --maxWorkers=2: ä¸¦åˆ—å®Ÿè¡Œæ•°ã‚’åˆ¶é™
jest --maxWorkers=2
# â†’ CIç’°å¢ƒã§ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚’é˜²ã
```

**é–‹ç™ºæ™‚ã®æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:**

```bash
# ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ†ã‚¹ãƒˆã‚’æ›¸ããªãŒã‚‰é–‹ç™º
$ npm run test:watch

# â†’ è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹
# â†’ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã ã‘ã‚’å†å®Ÿè¡Œã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚åˆ©ç”¨å¯èƒ½

# ã‚¹ãƒ†ãƒƒãƒ—2: ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç¢ºèª
$ npm run test:coverage

# â†’ coverage/lcov-report/index.html ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
# â†’ ã©ã®è¡ŒãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ãªã„ã‹ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã§ç¢ºèªã§ãã‚‹

# ã‚¹ãƒ†ãƒƒãƒ—3: ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ç¢ºèª
$ npm run test

# â†’ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚Œã°OK
```

---

## 26.3 ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆã®åŸºæœ¬æ§‹é€ 

Jest ã®ãƒ†ã‚¹ãƒˆã¯ **3ã¤ã®åŸºæœ¬è¦ç´ ** ã§æ§‹æˆã•ã‚Œã¾ã™ï¼š

```
describeï¼ˆã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼‰
  â””â”€â”€ itï¼ˆå€‹åˆ¥ãƒ†ã‚¹ãƒˆï¼‰
       â””â”€â”€ expectï¼ˆæ¤œè¨¼ï¼‰
```

**åŸºæœ¬çš„ãªæ›¸ãæ–¹:**

```typescript
// src/lib/__tests__/utils.test.ts
import { formatDate, truncateText } from '../utils';

// describe: ãƒ†ã‚¹ãƒˆã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ï¼ˆãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°åã‚„æ©Ÿèƒ½åï¼‰
describe('formatDate', () => {
  
  // it: å€‹åˆ¥ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆã€Œã€œã™ã¹ãã€ã‚’è¨˜è¿°ï¼‰
  it('æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹', () => {
    // Arrangeï¼ˆæº–å‚™ï¼‰: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„
    const date = new Date('2025-12-28T10:00:00Z');
    
    // Actï¼ˆå®Ÿè¡Œï¼‰: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’å®Ÿè¡Œ
    const result = formatDate(date);
    
    // Assertï¼ˆæ¤œè¨¼ï¼‰: æœŸå¾…å€¤ã¨å®Ÿéš›ã®å€¤ã‚’æ¯”è¼ƒ
    expect(result).toBe('2025-12-28');
  });
});
```

**ã“ã®ã‚³ãƒ¼ãƒ‰ã®è©³ã—ã„èª¬æ˜:**

#### 1. `describe()` - ãƒ†ã‚¹ãƒˆã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–

```typescript
describe('formatDate', () => {
  // ã“ã®ä¸­ã«è¤‡æ•°ã® it() ã‚’æ›¸ã
});
```

- **ç¬¬1å¼•æ•°**: ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°åã‚„æ©Ÿèƒ½åï¼‰
- **ç¬¬2å¼•æ•°**: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ï¼ˆã“ã®ä¸­ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼‰
- **å½¹å‰²**: é–¢é€£ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ã¾ã¨ã‚ã¦ã€ãƒ¬ãƒãƒ¼ãƒˆã‚’è¦‹ã‚„ã™ãã™ã‚‹

**å®Ÿè¡Œçµæœã®ã‚¤ãƒ¡ãƒ¼ã‚¸:**
```bash
 PASS  src/lib/__tests__/utils.test.ts
  formatDate           â† describe ã®ã‚°ãƒ«ãƒ¼ãƒ—å
    âœ“ æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹ (3 ms)
    âœ“ null ã®å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™ (1 ms)
```

#### 2. `it()` ã¾ãŸã¯ `test()` - å€‹åˆ¥ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

```typescript
it('æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹', () => {
  // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
});

// it() ã¨ test() ã¯åŒã˜ï¼ˆå¥½ã¿ã§é¸ã¶ï¼‰
test('æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹', () => {
  // åŒã˜æ„å‘³
});
```

- **ç¬¬1å¼•æ•°**: ãƒ†ã‚¹ãƒˆã®èª¬æ˜ï¼ˆã€Œã€œã™ã¹ãã€ã€Œã€œã§ãã‚‹ã€ãªã©ï¼‰
- **ç¬¬2å¼•æ•°**: ãƒ†ã‚¹ãƒˆé–¢æ•°
- **å‘½åã®ã‚³ãƒ„**: æ—¥æœ¬èªã§æ›¸ãã¨åˆ†ã‹ã‚Šã‚„ã™ã„

**è‰¯ã„ä¾‹:**
```typescript
it('æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹')
it('null ã®å ´åˆã¯ç©ºæ–‡å­—ã‚’è¿”ã™')
it('ç„¡åŠ¹ãªæ—¥ä»˜ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹')
```

**æ‚ªã„ä¾‹:**
```typescript
it('test1')  // âŒ ä½•ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„
it('works')  // âŒ å…·ä½“çš„ã§ãªã„
```

#### 3. `expect()` - ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¤œè¨¼ï¼‰

```typescript
expect(result).toBe('2025-12-28');
```

- **`expect(å®Ÿéš›ã®å€¤)`**: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®å€¤
- **`.toBe(æœŸå¾…å€¤)`**: ãƒãƒƒãƒãƒ£ãƒ¼ï¼ˆæ¯”è¼ƒæ–¹æ³•ï¼‰
- **å½¹å‰²**: å®Ÿéš›ã®å€¤ãŒæœŸå¾…å€¤ã¨ä¸€è‡´ã™ã‚‹ã‹æ¤œè¨¼

**ä¸»ãªãƒãƒƒãƒãƒ£ãƒ¼:**

| ãƒãƒƒãƒãƒ£ãƒ¼ | ä½¿ç”¨ä¾‹ | èª¬æ˜ |
|-----------|--------|------|
| `toBe()` | `expect(x).toBe(5)` | å³å¯†ç­‰ä¾¡ï¼ˆ`===`ï¼‰ |
| `toEqual()` | `expect(obj).toEqual({a: 1})` | å€¤ã®ç­‰ä¾¡ï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»é…åˆ—ï¼‰ |
| `toBeNull()` | `expect(x).toBeNull()` | `null` ã§ã‚ã‚‹ |
| `toBeUndefined()` | `expect(x).toBeUndefined()` | `undefined` ã§ã‚ã‚‹ |
| `toBeTruthy()` | `expect(x).toBeTruthy()` | çœŸå€¤ï¼ˆtruthyï¼‰ã§ã‚ã‚‹ |
| `toBeFalsy()` | `expect(x).toBeFalsy()` | å½å€¤ï¼ˆfalsyï¼‰ã§ã‚ã‚‹ |
| `toContain()` | `expect(arr).toContain(3)` | é…åˆ—ãŒè¦ç´ ã‚’å«ã‚€ |
| `toThrow()` | `expect(fn).toThrow()` | ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹ |

**`toBe()` ã¨ `toEqual()` ã®é•ã„:**

```typescript
// ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å‹ï¼ˆæ•°å€¤ã€æ–‡å­—åˆ—ã€çœŸå½å€¤ï¼‰
expect(5).toBe(5);           // âœ“ OK
expect('hello').toBe('hello'); // âœ“ OK

// ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»é…åˆ—
const obj1 = { a: 1 };
const obj2 = { a: 1 };

expect(obj1).toBe(obj2);    // âŒ FAILï¼ˆå‚ç…§ãŒé•ã†ï¼‰
expect(obj1).toEqual(obj2); // âœ“ OKï¼ˆå€¤ãŒåŒã˜ï¼‰

// é…åˆ—
expect([1, 2]).toBe([1, 2]);    // âŒ FAIL
expect([1, 2]).toEqual([1, 2]); // âœ“ OK
```

**è¦šãˆæ–¹:**
```
æ•°å€¤ãƒ»æ–‡å­—åˆ—ãƒ»çœŸå½å€¤    â†’ toBe()
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ»é…åˆ—      â†’ toEqual()
```

#### 4. AAA ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆArrange-Act-Assertï¼‰

ãƒ†ã‚¹ãƒˆã¯ **3ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—** ã§æ›¸ãã¨åˆ†ã‹ã‚Šã‚„ã™ããªã‚Šã¾ã™ï¼š

```typescript
it('æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹', () => {
  // 1. Arrangeï¼ˆæº–å‚™ï¼‰: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„
  const date = new Date('2025-12-28T10:00:00Z');
  
  // 2. Actï¼ˆå®Ÿè¡Œï¼‰: ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’å®Ÿè¡Œ
  const result = formatDate(date);
  
  // 3. Assertï¼ˆæ¤œè¨¼ï¼‰: æœŸå¾…å€¤ã¨å®Ÿéš›ã®å€¤ã‚’æ¯”è¼ƒ
  expect(result).toBe('2025-12-28');
});
```

**å›³è§£:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Arrangeï¼ˆæº–å‚™ï¼‰                   â”‚
â”‚    ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ç”¨æ„        â”‚
â”‚    const input = ...                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Actï¼ˆå®Ÿè¡Œï¼‰                       â”‚
â”‚    ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®é–¢æ•°ã‚’å®Ÿè¡Œ            â”‚
â”‚    const result = func(input)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Assertï¼ˆæ¤œè¨¼ï¼‰                    â”‚
â”‚    æœŸå¾…é€šã‚Šã®çµæœã‹ç¢ºèª              â”‚
â”‚    expect(result).toBe(expected)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **åˆå¿ƒè€…ã¸ã®è£œè¶³:**
> - **describe**: ãƒ†ã‚¹ãƒˆã®ã€Œç« ã€ï¼ˆChapterï¼‰
> - **it**: ãƒ†ã‚¹ãƒˆã®ã€Œç¯€ã€ï¼ˆSectionï¼‰
> - **expect**: ãƒ†ã‚¹ãƒˆã®ã€Œæ¤œè¨¼ã€ï¼ˆVerificationï¼‰
> 
> **ãƒ†ã‚¹ãƒˆã®èª­ã¿æ–¹:**
> ```typescript
> describe('formatDate', () => {
>   it('æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹', () => {
>     // ...
>   });
> });
> ```
> â†’ ã€ŒformatDate ã¯æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã‚‹ã€ã¨èª­ã‚ã‚‹
>
> **ãƒã‚¹ãƒˆã‚‚å¯èƒ½:**
> ```typescript
> describe('formatDate', () => {
>   describe('æœ‰åŠ¹ãªæ—¥ä»˜ã®å ´åˆ', () => {
>     it('YYYY-MM-DD å½¢å¼ã§è¿”ã™', () => {});
>   });
>   
>   describe('ç„¡åŠ¹ãªæ—¥ä»˜ã®å ´åˆ', () => {
>     it('ç©ºæ–‡å­—ã‚’è¿”ã™', () => {});
>   });
> });
> ```

### å®Ÿéš›ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆ

**src/lib/utils.ts ã‚’ä½œæˆ:**

```typescript
// src/lib/utils.ts
export function formatDate(date: Date | string | null): string {
  if (!date) return '';
  const d = new Date(date);
  return d.toISOString().split('T')[0];
}

export function truncateText(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.substring(0, maxLength) + '...';
}

export function getYouTubeId(url: string): string | null {
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/,
    /youtube\.com\/embed\/([^&\n?#]+)/,
    /youtube\.com\/shorts\/([^&\n?#]+)/,
  ];

  for (const pattern of patterns) {
    const match = url.match(pattern);
    if (match) return match[1];
  }

  return null;
}

export function validateEmail(email: string): boolean {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}
```

**åŒ…æ‹¬çš„ãªãƒ†ã‚¹ãƒˆã‚’ä½œæˆ:**

```typescript
// src/lib/__tests__/utils.test.ts
import { formatDate, truncateText, getYouTubeId, validateEmail } from '../utils';

describe('utils', () => {
  describe('formatDate', () => {
    it('Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ', () => {
      const date = new Date('2025-12-28T10:00:00Z');
      expect(formatDate(date)).toBe('2025-12-28');
    });

    it('æ–‡å­—åˆ—ã®æ—¥ä»˜ã‚’æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ', () => {
      expect(formatDate('2025-12-28')).toBe('2025-12-28');
    });

    it('null ã®å ´åˆã¯ç©ºæ–‡å­—', () => {
      expect(formatDate(null)).toBe('');
    });

    it('ä¸æ­£ãªæ—¥ä»˜ã®å ´åˆã¯ NaN ã‚’å«ã¾ãªã„', () => {
      const result = formatDate('invalid-date');
      expect(result).not.toContain('NaN');
    });
  });

  describe('truncateText', () => {
    it('é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šè©°ã‚ã‚‹', () => {
      const text = 'ã“ã‚Œã¯ã¨ã¦ã‚‚é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã§ã™';
      expect(truncateText(text, 10)).toBe('ã“ã‚Œã¯ã¨ã¦ã‚‚é•·ã„...');
    });

    it('çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆã¯ãã®ã¾ã¾', () => {
      expect(truncateText('çŸ­ã„', 10)).toBe('çŸ­ã„');
    });

    it('ç©ºæ–‡å­—ã®å ´åˆ', () => {
      expect(truncateText('', 10)).toBe('');
    });

    it('æœ€å¤§é•·ã¨åŒã˜å ´åˆ', () => {
      expect(truncateText('1234567890', 10)).toBe('1234567890');
    });
  });

  describe('getYouTubeId', () => {
    it('watch URL ã‹ã‚‰IDã‚’æŠ½å‡º', () => {
      const url = 'https://www.youtube.com/watch?v=dQw4w9WgXcQ';
      expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
    });

    it('çŸ­ç¸®URL ã‹ã‚‰IDã‚’æŠ½å‡º', () => {
      const url = 'https://youtu.be/dQw4w9WgXcQ';
      expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
    });

    it('embed URL ã‹ã‚‰IDã‚’æŠ½å‡º', () => {
      const url = 'https://www.youtube.com/embed/dQw4w9WgXcQ';
      expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
    });

    it('shorts URL ã‹ã‚‰IDã‚’æŠ½å‡º', () => {
      const url = 'https://www.youtube.com/shorts/dQw4w9WgXcQ';
      expect(getYouTubeId(url)).toBe('dQw4w9WgXcQ');
    });

    it('ä¸æ­£ãªURLã®å ´åˆã¯null', () => {
      expect(getYouTubeId('https://example.com')).toBeNull();
    });
  });

  describe('validateEmail', () => {
    it('æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹', () => {
      expect(validateEmail('user@example.com')).toBe(true);
    });

    it('@ãŒãªã„å ´åˆã¯false', () => {
      expect(validateEmail('userexample.com')).toBe(false);
    });

    it('ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒãªã„å ´åˆã¯false', () => {
      expect(validateEmail('user@')).toBe(false);
    });

    it('ç©ºæ–‡å­—ã®å ´åˆã¯false', () => {
      expect(validateEmail('')).toBe(false);
    });

    it('ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€å ´åˆã¯false', () => {
      expect(validateEmail('user @example.com')).toBe(false);
    });
  });
});
```

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
npm test

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•å®Ÿè¡Œï¼‰
npm run test:watch

# ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’è¡¨ç¤º
npm run test:coverage
```

**å‡ºåŠ›ä¾‹:**

```
PASS  src/lib/__tests__/utils.test.ts
  utils
    formatDate
      âœ“ Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (3 ms)
      âœ“ æ–‡å­—åˆ—ã®æ—¥ä»˜ã‚’æ­£ã—ããƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ (1 ms)
      âœ“ null ã®å ´åˆã¯ç©ºæ–‡å­— (1 ms)
      âœ“ ä¸æ­£ãªæ—¥ä»˜ã®å ´åˆã¯ NaN ã‚’å«ã¾ãªã„ (1 ms)
    truncateText
      âœ“ é•·ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šè©°ã‚ã‚‹ (1 ms)
      âœ“ çŸ­ã„ãƒ†ã‚­ã‚¹ãƒˆã¯ãã®ã¾ã¾ (1 ms)
      âœ“ ç©ºæ–‡å­—ã®å ´åˆ (1 ms)
      âœ“ æœ€å¤§é•·ã¨åŒã˜å ´åˆ (1 ms)
    getYouTubeId
      âœ“ watch URL ã‹ã‚‰IDã‚’æŠ½å‡º (1 ms)
      âœ“ çŸ­ç¸®URL ã‹ã‚‰IDã‚’æŠ½å‡º (1 ms)
      âœ“ embed URL ã‹ã‚‰IDã‚’æŠ½å‡º (1 ms)
      âœ“ shorts URL ã‹ã‚‰IDã‚’æŠ½å‡º (1 ms)
      âœ“ ä¸æ­£ãªURLã®å ´åˆã¯null (1 ms)
    validateEmail
      âœ“ æ­£ã—ã„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ (1 ms)
      âœ“ @ãŒãªã„å ´åˆã¯false (1 ms)
      âœ“ ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒãªã„å ´åˆã¯false (1 ms)
      âœ“ ç©ºæ–‡å­—ã®å ´åˆã¯false (1 ms)
      âœ“ ã‚¹ãƒšãƒ¼ã‚¹ã‚’å«ã‚€å ´åˆã¯false (1 ms)

Test Suites: 1 passed, 1 total
Tests:       18 passed, 18 total
Snapshots:   0 total
Time:        2.345 s
```

---

## 26.4 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

### React Testing Library ã®åŸºæœ¬

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆã®åŸå‰‡:**

```
React Testing Library ã®å“²å­¦:
âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹ã‚‚ã®ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹
âœ… å®Ÿè£…ã®è©³ç´°ã‚’ãƒ†ã‚¹ãƒˆã—ãªã„
âœ… ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã‚’é‡è¦–
âœ… å®Ÿéš›ã®ä½¿ã„æ–¹ã«è¿‘ã„ãƒ†ã‚¹ãƒˆ
```

### å˜ç´”ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

**Button ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ:**

```typescript
// src/components/Button.tsx
import { ButtonHTMLAttributes, ReactNode } from 'react';

interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'primary' | 'secondary' | 'danger';
  children: ReactNode;
}

export default function Button({ 
  variant = 'primary', 
  children, 
  className = '',
  ...props 
}: ButtonProps) {
  const baseClass = 'px-4 py-2 rounded font-medium';
  const variantClass = {
    primary: 'bg-blue-500 text-white hover:bg-blue-600',
    secondary: 'bg-gray-300 text-gray-800 hover:bg-gray-400',
    danger: 'bg-red-500 text-white hover:bg-red-600',
  };

  return (
    <button
      className={`${baseClass} ${variantClass[variant]} ${className}`}
      {...props}
    >
      {children}
    </button>
  );
}
```

**Button ã®ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ:**

```typescript
// src/components/__tests__/Button.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import Button from '../Button';

describe('Button', () => {
  it('å­è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<Button>ã‚¯ãƒªãƒƒã‚¯</Button>);
    expect(screen.getByText('ã‚¯ãƒªãƒƒã‚¯')).toBeInTheDocument();
  });

  it('onClick ãŒå‘¼ã°ã‚Œã‚‹', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick}>ã‚¯ãƒªãƒƒã‚¯</Button>);
    
    fireEvent.click(screen.getByText('ã‚¯ãƒªãƒƒã‚¯'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('primary variant ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹', () => {
    render(<Button variant="primary">Primary</Button>);
    const button = screen.getByText('Primary');
    expect(button).toHaveClass('bg-blue-500');
  });

  it('secondary variant ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹', () => {
    render(<Button variant="secondary">Secondary</Button>);
    const button = screen.getByText('Secondary');
    expect(button).toHaveClass('bg-gray-300');
  });

  it('danger variant ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒé©ç”¨ã•ã‚Œã‚‹', () => {
    render(<Button variant="danger">Danger</Button>);
    const button = screen.getByText('Danger');
    expect(button).toHaveClass('bg-red-500');
  });

  it('disabled çŠ¶æ…‹ãŒæ©Ÿèƒ½ã™ã‚‹', () => {
    const handleClick = jest.fn();
    render(<Button onClick={handleClick} disabled>ã‚¯ãƒªãƒƒã‚¯</Button>);
    
    const button = screen.getByText('ã‚¯ãƒªãƒƒã‚¯');
    fireEvent.click(button);
    
    expect(handleClick).not.toHaveBeenCalled();
    expect(button).toBeDisabled();
  });

  it('ã‚«ã‚¹ã‚¿ãƒ ã‚¯ãƒ©ã‚¹ãŒé©ç”¨ã•ã‚Œã‚‹', () => {
    render(<Button className="custom-class">Button</Button>);
    expect(screen.getByText('Button')).toHaveClass('custom-class');
  });
});
```

### ãƒ•ã‚©ãƒ¼ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

**LoginForm ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ:**

```typescript
// src/components/LoginForm.tsx
'use client';

import { useState } from 'react';
import Button from './Button';

interface LoginFormProps {
  onSubmit: (email: string, password: string) => Promise<void>;
}

export default function LoginForm({ onSubmit }: LoginFormProps) {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    if (!email || !password) {
      setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }

    setLoading(true);
    try {
      await onSubmit(email, password);
    } catch (err) {
      setError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit} aria-label="ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ">
      {error && (
        <div role="alert" className="text-red-500 mb-4">
          {error}
        </div>
      )}
      
      <div className="mb-4">
        <label htmlFor="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input
          id="email"
          type="email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
          placeholder="user@example.com"
          className="w-full px-3 py-2 border rounded"
        />
      </div>

      <div className="mb-4">
        <label htmlFor="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input
          id="password"
          type="password"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
          placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
          className="w-full px-3 py-2 border rounded"
        />
      </div>

      <Button type="submit" disabled={loading}>
        {loading ? 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³'}
      </Button>
    </form>
  );
}
```

**LoginForm ã®ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ:**

```typescript
// src/components/__tests__/LoginForm.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import LoginForm from '../LoginForm';

describe('LoginForm', () => {
  it('ãƒ•ã‚©ãƒ¼ãƒ ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    const mockSubmit = jest.fn();
    render(<LoginForm onSubmit={mockSubmit} />);

    expect(screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹')).toBeInTheDocument();
    expect(screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰')).toBeInTheDocument();
    expect(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' })).toBeInTheDocument();
  });

  it('å…¥åŠ›å€¤ãŒå¤‰æ›´ã•ã‚Œã‚‹', async () => {
    const user = userEvent.setup();
    const mockSubmit = jest.fn();
    render(<LoginForm onSubmit={mockSubmit} />);

    const emailInput = screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹');
    const passwordInput = screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰');

    await user.type(emailInput, 'user@example.com');
    await user.type(passwordInput, 'password123');

    expect(emailInput).toHaveValue('user@example.com');
    expect(passwordInput).toHaveValue('password123');
  });

  it('ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async () => {
    const mockSubmit = jest.fn();
    render(<LoginForm onSubmit={mockSubmit} />);

    const submitButton = screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' });
    fireEvent.click(submitButton);

    expect(await screen.findByRole('alert')).toHaveTextContent(
      'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'
    );
    expect(mockSubmit).not.toHaveBeenCalled();
  });

  it('æ­£ã—ãå…¥åŠ›ã—ã¦é€ä¿¡ã™ã‚‹ã¨ onSubmit ãŒå‘¼ã°ã‚Œã‚‹', async () => {
    const user = userEvent.setup();
    const mockSubmit = jest.fn().mockResolvedValue(undefined);
    render(<LoginForm onSubmit={mockSubmit} />);

    await user.type(screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'), 'user@example.com');
    await user.type(screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'), 'password123');
    await user.click(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' }));

    await waitFor(() => {
      expect(mockSubmit).toHaveBeenCalledWith('user@example.com', 'password123');
    });
  });

  it('é€ä¿¡ä¸­ã¯ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã‚‹', async () => {
    const user = userEvent.setup();
    const mockSubmit = jest.fn(() => new Promise(resolve => setTimeout(resolve, 1000)));
    render(<LoginForm onSubmit={mockSubmit} />);

    await user.type(screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'), 'user@example.com');
    await user.type(screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'), 'password123');
    await user.click(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' }));

    expect(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...' })).toBeDisabled();
  });

  it('é€ä¿¡ã‚¨ãƒ©ãƒ¼æ™‚ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async () => {
    const user = userEvent.setup();
    const mockSubmit = jest.fn().mockRejectedValue(new Error('Login failed'));
    render(<LoginForm onSubmit={mockSubmit} />);

    await user.type(screen.getByLabelText('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹'), 'user@example.com');
    await user.type(screen.getByLabelText('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰'), 'wrongpassword');
    await user.click(screen.getByRole('button', { name: 'ãƒ­ã‚°ã‚¤ãƒ³' }));

    expect(await screen.findByRole('alert')).toHaveTextContent(
      'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ'
    );
  });
});
```

---

## 26.5 ãƒ¢ãƒƒã‚¯ã¨ã‚¹ãƒ‘ã‚¤

### jest.fn() ã§ãƒ¢ãƒƒã‚¯é–¢æ•°ã‚’ä½œæˆ

```typescript
// ãƒ¢ãƒƒã‚¯é–¢æ•°ã®åŸºæœ¬
const mockFn = jest.fn();

// ãƒ¢ãƒƒã‚¯é–¢æ•°ã‚’å‘¼ã¶
mockFn('arg1', 'arg2');

// ã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³
expect(mockFn).toHaveBeenCalled();
expect(mockFn).toHaveBeenCalledWith('arg1', 'arg2');
expect(mockFn).toHaveBeenCalledTimes(1);
```

### æˆ»ã‚Šå€¤ã‚’è¨­å®š

```typescript
// å›ºå®šã®æˆ»ã‚Šå€¤
const mockFn = jest.fn().mockReturnValue(42);
expect(mockFn()).toBe(42);

// Promise ã‚’è¿”ã™
const mockAsync = jest.fn().mockResolvedValue('success');
await expect(mockAsync()).resolves.toBe('success');

// ã‚¨ãƒ©ãƒ¼ã‚’æŠ•ã’ã‚‹
const mockError = jest.fn().mockRejectedValue(new Error('Error'));
await expect(mockError()).rejects.toThrow('Error');

// å®Ÿè£…ã‚’è¨­å®š
const mockImpl = jest.fn((x, y) => x + y);
expect(mockImpl(2, 3)).toBe(5);
```

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¨ä½“ã‚’ãƒ¢ãƒƒã‚¯

```typescript
// src/lib/api.ts
export async function fetchPosts() {
  const res = await fetch('/api/posts');
  return res.json();
}

// src/lib/__tests__/api.test.ts
import { fetchPosts } from '../api';

// fetch ã‚’ãƒ¢ãƒƒã‚¯
global.fetch = jest.fn();

describe('fetchPosts', () => {
  beforeEach(() => {
    // å„ãƒ†ã‚¹ãƒˆã®å‰ã«ãƒ¢ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ
    (fetch as jest.Mock).mockClear();
  });

  it('æŠ•ç¨¿ä¸€è¦§ã‚’å–å¾—', async () => {
    const mockPosts = [
      { id: '1', title: 'Post 1' },
      { id: '2', title: 'Post 2' },
    ];

    (fetch as jest.Mock).mockResolvedValue({
      json: async () => mockPosts,
    });

    const posts = await fetchPosts();
    expect(posts).toEqual(mockPosts);
    expect(fetch).toHaveBeenCalledWith('/api/posts');
  });

  it('ã‚¨ãƒ©ãƒ¼æ™‚ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹', async () => {
    (fetch as jest.Mock).mockRejectedValue(new Error('Network error'));

    await expect(fetchPosts()).rejects.toThrow('Network error');
  });
});
```

### å¤–éƒ¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ¢ãƒƒã‚¯

```typescript
// src/lib/__tests__/auth.test.ts
import { signIn } from 'next-auth/react';

// next-auth/react ã‚’ãƒ¢ãƒƒã‚¯
jest.mock('next-auth/react', () => ({
  signIn: jest.fn(),
}));

describe('ãƒ­ã‚°ã‚¤ãƒ³', () => {
  it('signIn ãŒæ­£ã—ãå‘¼ã°ã‚Œã‚‹', async () => {
    (signIn as jest.Mock).mockResolvedValue({ ok: true });

    await signIn('credentials', {
      email: 'user@example.com',
      password: 'password123',
    });

    expect(signIn).toHaveBeenCalledWith('credentials', {
      email: 'user@example.com',
      password: 'password123',
    });
  });
});
```

---

## 26.6 éåŒæœŸå‡¦ç†ã®ãƒ†ã‚¹ãƒˆ

### async/await ã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆ

```typescript
// src/lib/api.ts
export async function createPost(title: string, content: string) {
  const res = await fetch('/api/posts', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title, content }),
  });

  if (!res.ok) {
    throw new Error('Failed to create post');
  }

  return res.json();
}

// src/lib/__tests__/api.test.ts
describe('createPost', () => {
  it('æŠ•ç¨¿ã‚’ä½œæˆ', async () => {
    const mockPost = { id: '1', title: 'New Post', content: 'Content' };

    (fetch as jest.Mock).mockResolvedValue({
      ok: true,
      json: async () => mockPost,
    });

    const post = await createPost('New Post', 'Content');

    expect(post).toEqual(mockPost);
    expect(fetch).toHaveBeenCalledWith('/api/posts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title: 'New Post', content: 'Content' }),
    });
  });

  it('ã‚¨ãƒ©ãƒ¼æ™‚ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹', async () => {
    (fetch as jest.Mock).mockResolvedValue({
      ok: false,
    });

    await expect(createPost('New Post', 'Content')).rejects.toThrow(
      'Failed to create post'
    );
  });
});
```

### waitFor ã‚’ä½¿ã£ãŸéåŒæœŸãƒ†ã‚¹ãƒˆ

```typescript
import { render, screen, waitFor } from '@testing-library/react';

describe('éåŒæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿', () => {
  it('ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async () => {
    render(<PostList />);

    // æœ€åˆã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    expect(screen.getByText('èª­ã¿è¾¼ã¿ä¸­...')).toBeInTheDocument();

    // ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§å¾…ã¤
    await waitFor(() => {
      expect(screen.getByText('Post 1')).toBeInTheDocument();
    });

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãŒæ¶ˆãˆã‚‹
    expect(screen.queryByText('èª­ã¿è¾¼ã¿ä¸­...')).not.toBeInTheDocument();
  });
});
```

---

## 26.7 ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¨ã¯

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‡ºåŠ›ã‚’ä¿å­˜ã—ã€å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã«æ¤œçŸ¥ã™ã‚‹ãƒ†ã‚¹ãƒˆã€‚

```typescript
// src/components/__tests__/Card.test.tsx
import { render } from '@testing-library/react';
import Card from '../Card';

describe('Card', () => {
  it('ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¨ä¸€è‡´ã™ã‚‹', () => {
    const { container } = render(
      <Card title="ã‚¿ã‚¤ãƒˆãƒ«">
        <p>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„</p>
      </Card>
    );

    expect(container.firstChild).toMatchSnapshot();
  });
});
```

**åˆå›å®Ÿè¡Œæ™‚:**
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`__snapshots__/Card.test.tsx.snap`ï¼‰ãŒç”Ÿæˆã•ã‚Œã‚‹

**2å›ç›®ä»¥é™:**
- å‡ºåŠ›ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚Œã°ã€ãƒ†ã‚¹ãƒˆãŒå¤±æ•—
- `npm test -- -u` ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‚’æ›´æ–°

---

## 26.8 ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¢ºèª

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®è¦‹æ–¹

```bash
npm run test:coverage
```

**å‡ºåŠ›ä¾‹:**

```
File                | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s
--------------------|---------|----------|---------|---------|-------------------
All files           |   85.42 |    78.26 |   88.89 |   85.14 |
 components         |   92.31 |    87.50 |   95.45 |   92.00 |
  Button.tsx        |     100 |      100 |     100 |     100 |
  LoginForm.tsx     |   88.24 |    83.33 |   90.91 |   87.50 | 25-28, 40
 lib                |   78.57 |    68.75 |   82.35 |   78.26 |
  utils.ts          |   95.45 |    90.00 |     100 |   95.24 | 45
  api.ts            |   62.50 |    50.00 |   66.67 |   61.54 | 12-18, 25-30
```

**ã‚«ãƒãƒ¬ãƒƒã‚¸ã®ç¨®é¡:**

| ç¨®é¡ | èª¬æ˜ |
|------|------|
| Statements | å®Ÿè¡Œã•ã‚ŒãŸæ–‡ã®å‰²åˆ |
| Branch | åˆ†å²ï¼ˆifæ–‡ãªã©ï¼‰ã®ã‚«ãƒãƒ¼ç‡ |
| Functions | å®Ÿè¡Œã•ã‚ŒãŸé–¢æ•°ã®å‰²åˆ |
| Lines | å®Ÿè¡Œã•ã‚ŒãŸè¡Œã®å‰²åˆ |

### ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å‘ä¸Šã•ã›ã‚‹

**ã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ãªã„ç®‡æ‰€ã‚’ç‰¹å®š:**

```typescript
// api.ts ã® 12-18è¡Œç›®ãŒã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ãªã„
export async function deletePost(id: string) {
  const res = await fetch(`/api/posts/${id}`, {  // â† 12è¡Œç›®
    method: 'DELETE',
  });

  if (!res.ok) {
    throw new Error('Failed to delete post');   // â† 18è¡Œç›®
  }
}
```

**ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ :**

```typescript
describe('deletePost', () => {
  it('æŠ•ç¨¿ã‚’å‰Šé™¤', async () => {
    (fetch as jest.Mock).mockResolvedValue({ ok: true });

    await deletePost('1');

    expect(fetch).toHaveBeenCalledWith('/api/posts/1', {
      method: 'DELETE',
    });
  });

  it('ã‚¨ãƒ©ãƒ¼æ™‚ã«ä¾‹å¤–ã‚’æŠ•ã’ã‚‹', async () => {
    (fetch as jest.Mock).mockResolvedValue({ ok: false });

    await expect(deletePost('1')).rejects.toThrow('Failed to delete post');
  });
});
```

---

## 26.9 å®Ÿè·µï¼šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆ

### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ

**src/lib/__tests__/permissions.test.ts ã‚’ä½œæˆ:**

```typescript
import { canCreatePost, canEditPost, canDeletePost } from '../permissions';

describe('permissions', () => {
  const admin = { id: '1', role: 'admin' };
  const member = { id: '2', role: 'member' };
  const guest = null;

  describe('canCreatePost', () => {
    it('ç®¡ç†è€…ã¯ä½œæˆå¯èƒ½', () => {
      expect(canCreatePost(admin)).toBe(true);
    });

    it('ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä½œæˆä¸å¯', () => {
      expect(canCreatePost(member)).toBe(false);
    });

    it('æœªãƒ­ã‚°ã‚¤ãƒ³ã¯ä½œæˆä¸å¯', () => {
      expect(canCreatePost(guest)).toBe(false);
    });
  });

  describe('canEditPost', () => {
    const post = { userId: '1' };

    it('æŠ•ç¨¿è€…ã¯ç·¨é›†å¯èƒ½', () => {
      expect(canEditPost(admin, post)).toBe(true);
    });

    it('ç®¡ç†è€…ã¯ä»–äººã®æŠ•ç¨¿ã‚‚ç·¨é›†å¯èƒ½', () => {
      const otherPost = { userId: '999' };
      expect(canEditPost(admin, otherPost)).toBe(true);
    });

    it('ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä»–äººã®æŠ•ç¨¿ã‚’ç·¨é›†ä¸å¯', () => {
      const otherPost = { userId: '999' };
      expect(canEditPost(member, otherPost)).toBe(false);
    });
  });
});
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

**src/components/__tests__/PostCard.test.tsx ã‚’ä½œæˆ:**

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import PostCard from '../PostCard';

describe('PostCard', () => {
  const mockPost = {
    id: '1',
    title: 'ãƒ†ã‚¹ãƒˆæŠ•ç¨¿',
    content: 'ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™',
    createdAt: new Date('2025-12-28'),
    user: {
      name: 'ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
      avatar: '/avatar.jpg',
    },
    likes: [{ id: '1' }],
    comments: [{ id: '1' }, { id: '2' }],
  };

  it('æŠ•ç¨¿æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<PostCard post={mockPost} />);

    expect(screen.getByText('ãƒ†ã‚¹ãƒˆæŠ•ç¨¿')).toBeInTheDocument();
    expect(screen.getByText('ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™')).toBeInTheDocument();
    expect(screen.getByText('ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼')).toBeInTheDocument();
  });

  it('ã„ã„ã­æ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<PostCard post={mockPost} />);

    expect(screen.getByText('1')).toBeInTheDocument(); // ã„ã„ã­æ•°
  });

  it('ã‚³ãƒ¡ãƒ³ãƒˆæ•°ãŒè¡¨ç¤ºã•ã‚Œã‚‹', () => {
    render(<PostCard post={mockPost} />);

    expect(screen.getByText('2')).toBeInTheDocument(); // ã‚³ãƒ¡ãƒ³ãƒˆæ•°
  });

  it('ã„ã„ã­ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ onLike ãŒå‘¼ã°ã‚Œã‚‹', () => {
    const mockOnLike = jest.fn();
    render(<PostCard post={mockPost} onLike={mockOnLike} />);

    const likeButton = screen.getByRole('button', { name: /ã„ã„ã­/i });
    fireEvent.click(likeButton);

    expect(mockOnLike).toHaveBeenCalledWith('1');
  });
});
```

---

## 26.10 CI/CD ã§ã®å˜ä½“ãƒ†ã‚¹ãƒˆ

### GitHub Actions ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

**.github/workflows/test.yml ã‚’ä½œæˆ:**

```yaml
name: Unit Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run unit tests
        run: npm run test:ci

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella
```

---

## ã¾ã¨ã‚

ã“ã®ç« ã§å­¦ã‚“ã ã“ã¨ï¼š

âœ… **Jest ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—** - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«
âœ… **é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ** - describe, it, expect
âœ… **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ** - React Testing Library
âœ… **ãƒ¢ãƒƒã‚¯ã¨ã‚¹ãƒ‘ã‚¤** - jest.fn(), mockResolvedValue
âœ… **éåŒæœŸãƒ†ã‚¹ãƒˆ** - async/await, waitFor
âœ… **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒ†ã‚¹ãƒˆ** - toMatchSnapshot
âœ… **ã‚«ãƒãƒ¬ãƒƒã‚¸** - ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®è¦‹æ–¹
âœ… **CI/CDçµ±åˆ** - GitHub Actions ã§ãƒ†ã‚¹ãƒˆ

**æ¬¡ã®ç« ã§ã¯ã€çµåˆãƒ†ã‚¹ãƒˆï¼ˆIntegration Testï¼‰ã‚’å­¦ã³ã¾ã™ã€‚**

---

[â† å‰ã®ç« ï¼šç¬¬25ç«  ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](25-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°.md) | [ç›®æ¬¡ã«æˆ»ã‚‹](00-ç›®æ¬¡.md) | [æ¬¡ã®ç« ã¸ï¼šç¬¬27ç«  çµåˆãƒ†ã‚¹ãƒˆã®å®Ÿè£… â†’](27-çµåˆãƒ†ã‚¹ãƒˆã®å®Ÿè£….md)
