# ç¬¬32ç« ï¼šNext.js App Routerãƒšãƒ¼ã‚¸å®Ÿè£…ã®è©³ç´°

> **å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€å„ãƒšãƒ¼ã‚¸ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©³ç´°è§£èª¬**

## ğŸ“š ã“ã®ç« ã®ç›®çš„

ã“ã®ç« ã¯**å®Ÿè£…ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹**ã¨ã—ã¦ã€å„ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä»•çµ„ã¿ã‚’æ·±ãç†è§£ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

- âœ… Server Component ã¨ Client Component ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³  
- âœ… ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ã®å®Ÿè£…
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
- âœ… æ¥½è¦³çš„UIæ›´æ–°ï¼ˆOptimistic UIï¼‰
- âœ… èªè¨¼ã‚¬ãƒ¼ãƒ‰ã¨ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

## ğŸ’¡ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒšãƒ¼ã‚¸æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ä¸€è¦§                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ãƒ«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã€‘
1. src/app/page.tsx + HomeClient.tsx
   â†’ ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆServer + Client Component ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
2. src/app/layout.tsx
   â†’ ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã€Providersï¼‰

ã€æŠ•ç¨¿é–¢é€£ã€‘ï¼ˆçµ±åˆãƒšãƒ¼ã‚¸æ–¹å¼ï¼‰
3. src/app/posts/page.tsx
   â†’ æŠ•ç¨¿ä¸€è¦§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãƒ»ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆã™ã¹ã¦çµ±åˆï¼‰

ã€ã‚¤ãƒ™ãƒ³ãƒˆé–¢é€£ã€‘
4. src/app/events/page.tsx
   â†’ ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ãƒ»ä½œæˆãƒ»ç·¨é›†ãƒ»å‚åŠ ç™»éŒ²
5. src/app/events/[id]/report/page.tsx
   â†’ ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰æ´»å‹•å ±å‘Šã‚’ä½œæˆ

ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é–¢é€£ã€‘
6. src/app/activity-schedules/page.tsx
   â†’ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¸€è¦§ãƒ»ä½œæˆãƒ»æŠ•ç¥¨

ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã€‘
7. src/app/users/page.tsx
   â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
8. src/app/users/[id]/page.tsx
   â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°
9. src/app/profile/page.tsx
   â†’ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†

ã€èªè¨¼é–¢é€£ã€‘
10. src/app/auth/signin/page.tsx
    â†’ ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ¡ãƒ¼ãƒ«/Google OAuthï¼‰
```

**è¨­è¨ˆæ€æƒ³ï¼šçµ±åˆãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€æŠ•ç¨¿ã®ä¸€è¦§ãƒ»ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã‚’ **1ã¤ã®ãƒšãƒ¼ã‚¸** ã«çµ±åˆã™ã‚‹è¨­è¨ˆã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     å¾“æ¥å‹ vs çµ±åˆå‹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âŒ å¾“æ¥å‹ï¼ˆãƒšãƒ¼ã‚¸åˆ†é›¢ï¼‰
posts/
â”œâ”€ page.tsx        # ä¸€è¦§
â”œâ”€ new/
â”‚  â””â”€ page.tsx     # æ–°è¦ä½œæˆ
â””â”€ [id]/
   â”œâ”€ page.tsx     # è©³ç´°
   â””â”€ edit/
      â””â”€ page.tsx  # ç·¨é›†

âœ… ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆï¼ˆçµ±åˆå‹ï¼‰
posts/
â””â”€ page.tsx        # ä¸€è¦§ + ç·¨é›† + å‰Šé™¤
                  # è©³ç´°ã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã¾ãŸã¯å±•é–‹è¡¨ç¤º
                  # ã‚³ãƒ¡ãƒ³ãƒˆãƒ»ã„ã„ã­æ©Ÿèƒ½ã‚‚åŒãƒšãƒ¼ã‚¸

ã€çµ±åˆå‹ã®åˆ©ç‚¹ã€‘
âœ… ãƒšãƒ¼ã‚¸é·ç§»ãªã—ã§æ“ä½œå®Œçµï¼ˆUXå‘ä¸Šï¼‰
âœ… ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ãŒç°¡å˜ï¼ˆ1ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ï¼‰
âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ UIæ›´æ–°ãŒé«˜é€Ÿ
âœ… æ¥½è¦³çš„UIæ›´æ–°ã®å®Ÿè£…ãŒå®¹æ˜“

ã€æ³¨æ„ç‚¹ã€‘
âš ï¸ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¤§ãããªã‚‹
   â†’ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«åˆ†å‰²ã—ã¦ç®¡ç†
âš ï¸ æ¨©é™ãƒã‚§ãƒƒã‚¯ãŒè¤‡é›‘
   â†’ ã‚«ã‚¹ã‚¿ãƒ Hookã§å…±é€šåŒ–
```

---

## 32.1 ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼ˆServer + Client Component ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼šåˆ†é›¢ãƒ‘ã‚¿ãƒ¼ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®æ§‹æˆï¼ˆ2ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

src/app/page.tsx (Server Component)
  â†“ ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
  â”œâ”€ await auth() ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—
  â”œâ”€ Prisma ã§æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆæœ€æ–°3ä»¶ã€äººæ°—3ä»¶ï¼‰
  â”œâ”€ ISR (revalidate = 60) ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶å¾¡
  â””â”€ HomeClient ã«åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™

  â†“ propsã§æ¸¡ã™

HomeClient.tsx (Client Component)
  â†“ ãƒ–ãƒ©ã‚¦ã‚¶å´ã§ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
  â”œâ”€ ScrollAnimation ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
  â”œâ”€ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆï¼ˆæœ€æ–°/äººæ°—ï¼‰
  â”œâ”€ YouTubeå‹•ç”»ã®è¡¨ç¤º
  â””â”€ ãƒ­ã‚°ã‚¤ãƒ³/ç™»éŒ²ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡
```

### src/app/page.tsxï¼ˆServer Componentï¼‰

```typescript
import Link from 'next/link'
import { Music, Calendar, FileText, Users } from 'lucide-react'
import { auth } from '@/lib/auth'
import { PrismaClient } from '@prisma/client'
import ScrollAnimation from '@/components/ScrollAnimation'
import HomeClient from './HomeClient'
import Footer from '@/components/Footer'

const prisma = new PrismaClient()

// ISR: 60ç§’ã”ã¨ã«ãƒšãƒ¼ã‚¸ã‚’å†ç”Ÿæˆ
export const revalidate = 60

export default async function Home() {
  const session = await auth()
  
  // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
  const allPosts = await prisma.post.findMany({
    include: {
      user: {
        select: {
          id: true,
          name: true,
          email: true,
          avatarUrl: true,
        },
      },
      likes: {
        select: {
          userId: true,
          createdAt: true,
        },
      },
    },
    orderBy: {
      createdAt: 'desc',
    },
  })

  // JSONåŒ–ï¼ˆDateå‹ã‚’stringã«å¤‰æ›ï¼‰
  const posts = allPosts.slice(0, 3).map((post) => ({
    ...post,
    content: post.content || '',
    title: post.title || '',
    createdAt: post.createdAt.toISOString(),
    user: {
      id: post.user.id,
      name: post.user.name || '',
      email: post.user.email || '',
      avatarUrl: post.user.avatarUrl || null,
    },
    likes: post.likes.map((like) => ({
      userId: like.userId,
      createdAt: like.createdAt.toISOString(),
    })),
  }))

  // ã„ã„ã­æ•°ã§ã‚½ãƒ¼ãƒˆ
  const sorted = [...allPosts].sort((a, b) => b.likes.length - a.likes.length)
  const popularPosts = sorted.slice(0, 3).filter(p => p.likes.length > 0).map((post) => ({
    ...post,
    content: post.content || '',
    title: post.title || '',
    createdAt: post.createdAt.toISOString(),
    user: {
      id: post.user.id,
      name: post.user.name || '',
      email: post.user.email || '',
      avatarUrl: post.user.avatarUrl || null,
    },
    likes: post.likes.map((like) => ({
      userId: like.userId,
      createdAt: like.createdAt.toISOString(),
    })),
  }))

  return (
    <div className="min-h-screen bg-linear-to-br from-slate-900 via-purple-900 to-slate-900">
      {/* Hero Section */}
      <div className="relative overflow-hidden h-[50vh]">
        {/* èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */}
        <div className="absolute inset-0">
          <div className="absolute w-[200%] h-full bg-cover bg-center opacity-40 animate-slide"></div>
          <div className="absolute inset-0 bg-linear-to-b from-slate-900/80 to-slate-900/90"></div>
        </div>
        
        <div className="container mx-auto px-4 py-20 relative">
          <ScrollAnimation animation="fade-up" delay={0}>
            <div className="text-center space-y-4">
              <Music className="w-16 h-16 text-white mx-auto" />
              <h1 className="text-6xl md:text-7xl font-extrabold text-transparent bg-clip-text bg-linear-to-r from-blue-400 via-purple-400 to-pink-400">
                BOLD è»½éŸ³
              </h1>
              <p className="text-3xl text-transparent bg-clip-text bg-linear-to-r from-purple-400 to-blue-400">
                ãƒ¡ãƒ³ãƒãƒ¼ã‚µã‚¤ãƒˆ
              </p>
            </div>
          </ScrollAnimation>
        </div>
      </div>

      {/* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <div className="container mx-auto px-4 py-16">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <Link href="/posts" className="group bg-white/10 backdrop-blur-md rounded-2xl p-8 hover:scale-105">
            <FileText className="w-16 h-16 text-blue-400 mb-4" />
            <h3 className="text-2xl font-bold text-white mb-3">æ´»å‹•å ±å‘Š</h3>
            <p className="text-white/70">ç·´ç¿’ã®æˆæœã‚„æ¼”å¥å‹•ç”»ã‚’å…±æœ‰</p>
          </Link>

          <Link href="/events" className="group bg-white/10 backdrop-blur-md rounded-2xl p-8 hover:scale-105">
            <Music className="w-16 h-16 text-purple-400 mb-4" />
            <h3 className="text-2xl font-bold text-white mb-3">ã‚¤ãƒ™ãƒ³ãƒˆ</h3>
            <p className="text-white/70">ãƒ©ã‚¤ãƒ–ã‚„ç™ºè¡¨ä¼šã®æƒ…å ±ç®¡ç†</p>
          </Link>

          <Link href="/activity-schedules" className="group bg-white/10 backdrop-blur-md rounded-2xl p-8 hover:scale-105">
            <Calendar className="w-16 h-16 text-green-400 mb-4" />
            <h3 className="text-2xl font-bold text-white mb-3">æ´»å‹•ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h3>
            <p className="text-white/70">ç·´ç¿’æ—¥ç¨‹ã‚’ç°¡å˜ã«èª¿æ•´</p>
          </Link>

          {session?.user?.role === 'site_admin' && (
            <Link href="/users" className="group bg-white/10 backdrop-blur-md rounded-2xl p-8 hover:scale-105">
              <Users className="w-16 h-16 text-orange-400 mb-4" />
              <h3 className="text-2xl font-bold text-white mb-3">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h3>
              <p className="text-white/70">ãƒ¡ãƒ³ãƒãƒ¼æƒ…å ±ã‚’ç®¡ç†</p>
            </Link>
          )}
        </div>
      </div>

      {/* Client Componentã«æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ */}
      <HomeClient posts={posts} popularPosts={popularPosts} />

      <Footer isSiteAdmin={session?.user?.role === 'site_admin'} isLoggedIn={!!session} />
    </div>
  )
}
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Server Component ã®ç‰¹å¾´                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€1. async/await ãŒä½¿ãˆã‚‹ã€‘
  export default async function Home() {
    const data = await prisma...
  }
  â†’ ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§awaitãŒä½¿ãˆã‚‹ï¼ˆServer Componentã®ã¿ï¼‰

ã€2. ISR (Incremental Static Regeneration)ã€‘
  export const revalidate = 60
  â†’ 60ç§’ã”ã¨ã«ãƒšãƒ¼ã‚¸ã‚’å†ç”Ÿæˆ
  â†’ æœ€åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¿”ã™ï¼ˆé«˜é€Ÿï¼‰

ã€3. Prismaã®ç›´æ¥åˆ©ç”¨ã€‘
  const prisma = new PrismaClient()
  const data = await prisma.post.findMany(...)
  â†’ API Routeã‚’çµŒç”±ã›ãšã€ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹

ã€4. auth()ã®ç›´æ¥å‘¼ã³å‡ºã—ã€‘
  const session = await auth()
  â†’ ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’å–å¾—
  â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã® useSession() ã‚ˆã‚Šé«˜é€Ÿ

ã€5. Dateå‹ã®JSONåŒ–ã€‘
  createdAt: post.createdAt.toISOString()
  â†’ Prisma ã® Date ã¯ JSON ã«ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã§ããªã„
  â†’ æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦Client Componentã«æ¸¡ã™
```

---

## 32.2 æŠ•ç¨¿ãƒšãƒ¼ã‚¸ï¼ˆçµ±åˆå‹å®Ÿè£…ï¼‰

### è¨­è¨ˆ: 1ã¤ã®ãƒšãƒ¼ã‚¸ã«ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’çµ±åˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     posts/page.tsx ã®æ©Ÿèƒ½ä¸€è¦§                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… æŠ•ç¨¿ä¸€è¦§è¡¨ç¤º
âœ… æŠ•ç¨¿ç·¨é›†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
âœ… æŠ•ç¨¿å‰Šé™¤ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
âœ… ã„ã„ã­æ©Ÿèƒ½ï¼ˆæ¥½è¦³çš„UIæ›´æ–°ï¼‰
âœ… ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ»è¡¨ç¤º
âœ… ã‚³ãƒ¡ãƒ³ãƒˆå‰Šé™¤ï¼ˆæœ¬äººãƒ»ç®¡ç†è€…ã®ã¿ï¼‰
âœ… YouTubeå‹•ç”»åŸ‹ã‚è¾¼ã¿ï¼ˆè¤‡æ•°å¯¾å¿œï¼‰
âœ… ç”»åƒè¡¨ç¤º
âœ… å‚åŠ è€…è¡¨ç¤º
âœ… ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
âœ… ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ï¼ˆLINEç­‰ã§ã®å…±æœ‰ç”¨ï¼‰

â†’ ã™ã¹ã¦1ã¤ã®Client Componentã§å®Ÿè£…
```

### src/app/posts/page.tsxï¼ˆæŠœç²‹ï¼‰

<details>
<summary>ãƒ•ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºï¼ˆ846è¡Œï¼‰</summary>

```typescript
'use client'

import { useState, useEffect, useCallback } from 'react'
import YouTube from 'react-youtube'
import { useSession } from 'next-auth/react'
import { Edit, Heart, MessageCircle, Send, Trash2, Copy, Check } from 'lucide-react'
import Link from 'next/link'
import Image from 'next/image'
import DashboardLayout from '@/components/DashboardLayout'
import LoadingSpinner from '@/components/LoadingSpinner'

interface Post {
  id: string
  title: string
  content: string
  youtubeUrls: string[]
  images?: string[]
  createdAt: string
  userId: string
  user: {
    id: string
    name: string
    email: string
    avatarUrl?: string | null
  }
  participants: {
    id: string
    status: string
    user: {
      id: string
      name: string
      email: string
    }
  }[]
  likes: {
    userId: string
    createdAt: string
  }[]
  comments?: {
    id: string
    content: string
    createdAt: string
    user: {
      id: string
      name: string
      email: string
    }
  }[]
  _count?: {
    comments: number
  }
}

const POSTS_PER_PAGE = 5

export default function PostsPage() {
  const { data: session } = useSession()
  const [posts, setPosts] = useState<Post[]>([])
  const [currentPage, setCurrentPage] = useState(1)
  const [fetchingPosts, setFetchingPosts] = useState(true)
  const [newComment, setNewComment] = useState<{ [postId: string]: string }>({})
  const [submittingComment, setSubmittingComment] = useState<string | null>(null)
  const [copiedPostId, setCopiedPostId] = useState<string | null>(null)

  const isAdmin = session?.user?.role === 'admin' || session?.user?.role === 'site_admin'

  useEffect(() => {
    fetchPosts()
  }, [])

  const fetchPosts = useCallback(async () => {
    setFetchingPosts(true)
    try {
      const res = await fetch('/api/posts')
      const data = await res.json()
      setPosts(data)
    } catch (error) {
      console.error('Failed to fetch posts:', error)
    } finally {
      setFetchingPosts(false)
    }
  }, [])

  // ã„ã„ã­æ©Ÿèƒ½ï¼ˆæ¥½è¦³çš„UIæ›´æ–°ï¼‰
  const handleLike = async (postId: string) => {
    if (!session?.user?.id) return
    
    // å…ˆã«ç”»é¢ã‚’æ›´æ–°
    setPosts(prevPosts => prevPosts.map(post => {
      if (post.id === postId) {
        return {
          ...post,
          likes: [...post.likes, { userId: session.user.id, createdAt: new Date().toISOString() }]
        }
      }
      return post
    }))

    try {
      const res = await fetch(`/api/posts/${postId}/like`, {
        method: 'POST',
      })
      
      if (!res.ok) {
        fetchPosts()  // å¤±æ•—ã—ãŸã‚‰å…ƒã«æˆ»ã™
      }
    } catch (error) {
      fetchPosts()
    }
  }

  const handleUnlike = async (postId: string) => {
    if (!session?.user?.id) return
    
    setPosts(prevPosts => prevPosts.map(post => {
      if (post.id === postId) {
        return {
          ...post,
          likes: post.likes.filter(like => like.userId !== session.user.id)
        }
      }
      return post
    }))

    try {
      const res = await fetch(`/api/posts/${postId}/like`, {
        method: 'DELETE',
      })
      
      if (!res.ok) {
        fetchPosts()
      }
    } catch (error) {
      fetchPosts()
    }
  }

  // ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿
  const handleCommentSubmit = async (postId: string) => {
    const commentContent = newComment[postId]?.trim()
    if (!commentContent || submittingComment) return

    setSubmittingComment(postId)

    try {
      const res = await fetch(`/api/posts/${postId}/comments`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: commentContent })
      })

      if (!res.ok) {
        alert('ã‚³ãƒ¡ãƒ³ãƒˆã®æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ')
        return
      }

      const newCommentData = await res.json()
      
      // ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆã«è¿½åŠ 
      setPosts(prevPosts => prevPosts.map(post => {
        if (post.id === postId) {
          return {
            ...post,
            comments: [...(post.comments || []), newCommentData]
          }
        }
        return post
      }))

      setNewComment(prev => ({ ...prev, [postId]: '' }))
    } catch (error) {
      console.error('Failed to post comment:', error)
      alert('ã‚³ãƒ¡ãƒ³ãƒˆã®æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ')
    } finally {
      setSubmittingComment(null)
    }
  }

  // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ï¼ˆLINEç­‰ã§ã®å…±æœ‰ç”¨ï¼‰
  const handleCopyContent = async (postId: string, content: string, youtubeUrls?: string[]) => {
    try {
      const tempDiv = document.createElement('div')
      tempDiv.innerHTML = content
      const textContent = tempDiv.textContent || tempDiv.innerText || ''
      
      let copyText = textContent
      
      if (youtubeUrls && youtubeUrls.length > 0) {
        copyText += '\n\nã€è»½éŸ³å‹•ç”»ã€‘\n'
        youtubeUrls.forEach((url, index) => {
          copyText += `${index + 1}. ${url}\n`
        })
      }
      
      const pageUrl = `${window.location.origin}/posts`
      copyText += `\nã€å¤§é˜ªè»½éŸ³éƒ¨Webã‚µã‚¤ãƒˆURLã€‘\n${pageUrl}`
      
      await navigator.clipboard.writeText(copyText)
      setCopiedPostId(postId)
      setTimeout(() => setCopiedPostId(null), 2000)
    } catch (error) {
      console.error('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ:', error)
      alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ')
    }
  }

  const extractYouTubeId = (url: string) => {
    const match = url.match(/(?:youtube\.com\/(?:watch\?v=|live\/|shorts\/|embed\/)|youtu\.be\/)([^&\n?#]+)/)
    return match ? match[1] : null
  }

  // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
  const totalPages = Math.ceil(posts.length / POSTS_PER_PAGE)
  const startIndex = (currentPage - 1) * POSTS_PER_PAGE
  const endIndex = startIndex + POSTS_PER_PAGE
  const currentPosts = posts.slice(startIndex, endIndex)

  // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘UI
  if (session) {
    return (
      <DashboardLayout>
        <div className="max-w-4xl mx-auto p-6">
          <h1 className="text-3xl font-bold mb-8 text-white">æ´»å‹•ä¸€è¦§</h1>

          {fetchingPosts ? (
            <LoadingSpinner size="lg" />
          ) : (
            <>
              {/* æŠ•ç¨¿ä¸€è¦§ */}
              <div className="space-y-6 mb-8">
                {currentPosts.map((post) => (
                  <div key={post.id} className="bg-white/10 backdrop-blur-md rounded-2xl shadow-xl p-6 border border-white/10">
                    {/* æŠ•ç¨¿ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                    <div className="flex justify-between items-start mb-4">
                      <div className="flex items-center gap-3">
                        <Link href={`/users/${post.userId}`}>
                          {post.user.avatarUrl ? (
                            <Image
                              src={post.user.avatarUrl}
                              alt={post.user.name || 'User'}
                              width={40}
                              height={40}
                              className="w-10 h-10 rounded-full object-cover"
                            />
                          ) : (
                            <div className="w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500"></div>
                          )}
                        </Link>
                        <div>
                          <h2 className="text-2xl font-bold text-white">{post.title}</h2>
                          <p className="text-sm text-white/60">
                            {post.user.name} / {new Date(post.createdAt).toLocaleDateString('ja-JP')}
                          </p>
                        </div>
                      </div>
                      {isAdmin && (
                        <div className="flex gap-2">
                          <button onClick={() => handleEdit(post)} className="text-blue-600 hover:bg-blue-50 p-2 rounded">
                            <Edit className="w-5 h-5" />
                          </button>
                          <button onClick={() => handleDelete(post.id)} className="text-red-600 hover:bg-red-50 p-2 rounded">
                            <Trash2 className="w-5 h-5" />
                          </button>
                        </div>
                      )}
                    </div>

                    {/* æŠ•ç¨¿å†…å®¹ */}
                    {post.content && (
                      <div className="flex justify-between gap-2 mb-4">
                        <div className="prose prose-invert max-w-none" dangerouslySetInnerHTML={{ __html: post.content }} />
                        <button
                          onClick={() => handleCopyContent(post.id, post.content, post.youtubeUrls)}
                          className="p-2 bg-white/10 hover:bg-white/20 text-white rounded-lg"
                        >
                          {copiedPostId === post.id ? <Check className="w-4 h-4 text-green-400" /> : <Copy className="w-4 h-4" />}
                        </button>
                      </div>
                    )}

                    {/* YouTubeå‹•ç”» */}
                    {post.youtubeUrls && post.youtubeUrls.length > 0 && (
                      <div className="space-y-4 mb-4">
                        {post.youtubeUrls.map((url, index) => {
                          const youtubeId = extractYouTubeId(url)
                          return youtubeId ? (
                            <div key={index} className="aspect-video rounded-lg overflow-hidden">
                              <YouTube videoId={youtubeId} opts={{ width: '100%', height: '100%' }} />
                            </div>
                          ) : null
                        })}
                      </div>
                    )}

                    {/* ã„ã„ã­ãƒœã‚¿ãƒ³ */}
                    <div className="flex items-center gap-4 pt-4 border-t">
                      <button
                        onClick={() => post.likes.some(l => l.userId === session.user.id) ? handleUnlike(post.id) : handleLike(post.id)}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg ${
                          post.likes.some(l => l.userId === session.user.id)
                            ? 'bg-red-500/20 text-red-400'
                            : 'bg-white/10 text-white'
                        }`}
                      >
                        <Heart className={post.likes.some(l => l.userId === session.user.id) ? 'fill-current' : ''} />
                        <span>{post.likes.length}</span>
                      </button>
                      <div className="flex items-center gap-2 text-white/70">
                        <MessageCircle className="w-5 h-5" />
                        <span>{(post.comments || []).length}</span>
                      </div>
                    </div>

                    {/* ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
                    <div className="mt-4 pt-4 border-t">
                      <h3 className="font-semibold mb-3">ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
                      
                      {/* ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ */}
                      {(post.comments || []).length > 0 && (
                        <div className="space-y-3 mb-4">
                          {(post.comments || []).map((comment) => (
                            <div key={comment.id} className="bg-white/5 rounded-lg p-3">
                              <div className="flex justify-between">
                                <div>
                                  <div className="font-semibold text-sm text-white">{comment.user.name}</div>
                                  <p className="text-white/80 mt-1">{comment.content}</p>
                                  <span className="text-xs text-white/50">
                                    {new Date(comment.createdAt).toLocaleString('ja-JP')}
                                  </span>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}

                      {/* ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ› */}
                      <div className="flex gap-2">
                        <input
                          type="text"
                          value={newComment[post.id] || ''}
                          onChange={(e) => setNewComment(prev => ({ ...prev, [post.id]: e.target.value }))}
                          onKeyPress={(e) => {
                            if (e.key === 'Enter' && !e.shiftKey) {
                              e.preventDefault()
                              handleCommentSubmit(post.id)
                            }
                          }}
                          placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›..."
                          className="flex-1 px-4 py-2 border border-white/20 rounded-lg bg-white/5 text-white"
                          disabled={submittingComment === post.id}
                        />
                        <button
                          onClick={() => handleCommentSubmit(post.id)}
                          disabled={!newComment[post.id]?.trim() || submittingComment === post.id}
                          className="p-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:scale-105"
                        >
                          <Send className="w-5 h-5" />
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>

              {/* ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ */}
              {totalPages > 1 && (
                <div className="flex justify-center items-center gap-2 mt-8">
                  <button
                    onClick={() => setCurrentPage(prev => Math.max(1, prev - 1))}
                    disabled={currentPage === 1}
                    className="p-2 rounded-lg border border-white/20 bg-white/10 text-white hover:bg-white/20 disabled:opacity-50"
                  >
                    &larr;
                  </button>
                  <span className="px-4 text-white">
                    {currentPage} / {totalPages}
                  </span>
                  <button
                    onClick={() => setCurrentPage(prev => Math.min(totalPages, prev + 1))}
                    disabled={currentPage === totalPages}
                    className="p-2 rounded-lg border border-white/20 bg-white/10 text-white hover:bg-white/20 disabled:opacity-50"
                  >
                    &rarr;
                  </button>
                </div>
              )}
            </>
          )}
        </div>
      </DashboardLayout>
    )
  }

  // æœªãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘UIï¼ˆå…¬é–‹ãƒ“ãƒ¥ãƒ¼ï¼‰
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
      {/* å…¬é–‹ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…ã¯çœç•¥... */}
    </div>
  )
}
```

</details>

**é‡è¦ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     æŠ•ç¨¿ãƒšãƒ¼ã‚¸ã®è¨­è¨ˆãƒã‚¤ãƒ³ãƒˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€1. æ¥½è¦³çš„UIæ›´æ–°ï¼ˆOptimistic UIï¼‰ã€‘
  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å³åº§ã«åå¿œ

  const handleLike = async (postId: string) => {
    // â‘  å…ˆã«ç”»é¢ã‚’æ›´æ–°ï¼ˆæ¥½è¦³çš„æ›´æ–°ï¼‰
    setPosts(/* æ›´æ–°ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ */)
    
    // â‘¡ ãã®å¾ŒAPIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    const res = await fetch('/api/posts/${postId}/like', { method: 'POST' })
    
    // â‘¢ å¤±æ•—ã—ãŸã‚‰å…ƒã«æˆ»ã™
    if (!res.ok) {
      fetchPosts()
    }
  }

  âœ… ãƒ¡ãƒªãƒƒãƒˆ:
    - å³åº§ã«åå¿œã™ã‚‹ï¼ˆUXå‘ä¸Šï¼‰
    - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶ã‚’æ„Ÿã˜ã•ã›ãªã„
  
  âš ï¸ æ³¨æ„ç‚¹:
    - å¤±æ•—æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå¿…è¦
    - æ¥½è¦³çš„æ›´æ–°ã¨å®Ÿãƒ‡ãƒ¼ã‚¿ã®åŒæœŸã‚’ä¿ã¤


ã€2. ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã®ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†ã€‘
  è¤‡æ•°ã®æŠ•ç¨¿ãã‚Œãã‚Œã«ã‚¹ãƒ†ãƒ¼ãƒˆã‚’æŒã¤

  const [newComment, setNewComment] = useState<{ [postId: string]: string }>({})
  
  // æŠ•ç¨¿ã”ã¨ã®ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›ã‚’ç®¡ç†
  <input value={newComment[post.id] || ''} />
  
  // æ›´æ–°
  setNewComment({ ...newComment, [postId]: 'new value' })


ã€3. æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€‘
  {post.youtubeUrls && post.youtubeUrls.length > 0 && (
    <div>YouTubeå‹•ç”»</div>
  )}
  
  {isAdmin && (
    <button>ç·¨é›†</button>
  )}


ã€4. ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€‘
  const startIndex = (currentPage - 1) * POSTS_PER_PAGE
  const endIndex = startIndex + POSTS_PER_PAGE
  const currentPosts = posts.slice(startIndex, endIndex)
  
  totalPages = Math.ceil(posts.length / POSTS_PER_PAGE)


ã€5. HTMLæ–‡å­—åˆ—ã®è¡¨ç¤ºã€‘
  dangerouslySetInnerHTML={{ __html: post.content }}
  
  âš ï¸ XSSå¯¾ç­–å¿…é ˆ:
    - ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚µãƒ‹ã‚¿ã‚¤ã‚º
    - ä¿¡é ¼ã§ãã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ä½¿ç”¨


ã€6. è¤‡æ•°YouTube URLå¯¾å¿œã€‘
  {post.youtubeUrls.map((url, index) => {
    const youtubeId = extractYouTubeId(url)
    return youtubeId ? <YouTube videoId={youtubeId} /> : null
  })}
  
  â†’ /watch, /live/, /shorts/, /embed/, youtu.be/ ã™ã¹ã¦å¯¾å¿œ
```

---

## 32.3 ã‚¤ãƒ™ãƒ³ãƒˆãƒšãƒ¼ã‚¸ï¼ˆçµ±åˆå‹å®Ÿè£…ï¼‰

### src/app/events/page.tsxï¼ˆæŠœç²‹ï¼‰

ã“ã®ãƒšãƒ¼ã‚¸ã‚‚ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’1ã¤ã«çµ±åˆã—ã¦ã„ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     events/page.tsx ã®æ©Ÿèƒ½ä¸€è¦§                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º
âœ… ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ»ç·¨é›†ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰
âœ… èª²é¡Œæ›²ç®¡ç†ï¼ˆè¤‡æ•°å¯¾å¿œã€YouTubeæ¤œç´¢ã€ãƒ‘ãƒ¼ãƒˆå‰²å½“ï¼‰
âœ… å‚åŠ ç™»éŒ²ãƒ»å–ã‚Šæ¶ˆã—
âœ… ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ»è¡¨ç¤º
âœ… ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰æ´»å‹•å ±å‘Šã‚’ä½œæˆ
âœ… ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ï¼ˆLINEã§ã®å…±æœ‰ç”¨ï¼‰
```

**èª²é¡Œæ›²ç®¡ç†ã®å®Ÿè£…ä¾‹ï¼š**

```typescript
// èª²é¡Œæ›²ã®å‹å®šç¾©
interface Song {
  title: string
  sheetUrl?: string
  youtubeUrl?: string
  parts: Array<{ instrument: string; player: string }>
}

// ãƒ•ã‚©ãƒ¼ãƒ çŠ¶æ…‹
const [formData, setFormData] = useState({
  title: '',
  content: '',
  date: '',
  locationName: '',
  locationUrl: '',
  songs: [] as Song[]
})

// èª²é¡Œæ›²ã‚’è¿½åŠ 
const addSong = () => {
  setFormData({
    ...formData,
    songs: [...formData.songs, { title: '', sheetUrl: '', youtubeUrl: '', parts: [] }]
  })
}

// èª²é¡Œæ›²ã®æ›²åã‚’è‡ªå‹•ã§YouTubeæ¤œç´¢
const handleSongTitleBlur = async (songIndex: number, title: string) => {
  if (!title || formData.songs[songIndex].youtubeUrl) return
  
  try {
    const res = await fetch(`/api/youtube/search?q=${encodeURIComponent(title)}`)
    if (res.ok) {
      const data = await res.json()
      if (data.url) {
        const newSongs = [...formData.songs]
        newSongs[songIndex].youtubeUrl = data.url
        setFormData({ ...formData, songs: newSongs })
      }
    }
  } catch (error) {
    console.error('YouTubeæ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error)
  }
}

// ãƒ‘ãƒ¼ãƒˆå‰²å½“
const addPart = (songIndex: number) => {
  const newSongs = [...formData.songs]
  newSongs[songIndex].parts.push({ instrument: 'vocal', player: '' })
  setFormData({ ...formData, songs: newSongs })
}

// ãƒ‘ãƒ¼ãƒˆæ›´æ–°
const updatePart = (
  songIndex: number,
  partIndex: number,
  field: 'instrument' | 'player',
  value: string
) => {
  const newSongs = [...formData.songs]
  newSongs[songIndex].parts[partIndex][field] = value
  setFormData({ ...formData, songs: newSongs })
}

// ãƒ•ã‚©ãƒ¼ãƒ UI
<form onSubmit={handleSubmit}>
  {/* èª²é¡Œæ›²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
  <div>
    <h3>èª²é¡Œæ›²</h3>
    {formData.songs.map((song, songIndex) => (
      <div key={songIndex}>
        {/* æ›²åå…¥åŠ›ï¼ˆè‡ªå‹•YouTubeæ¤œç´¢ï¼‰ */}
        <input
          type="text"
          value={song.title}
          onChange={(e) => updateSong(songIndex, 'title', e.target.value)}
          onBlur={(e) => handleSongTitleBlur(songIndex, e.target.value)}
          placeholder="æ›²å"
        />
        
        {/* æ¥½è­œURL */}
        <input
          type="url"
          value={song.sheetUrl}
          onChange={(e) => updateSong(songIndex, 'sheetUrl', e.target.value)}
          placeholder="æ¥½è­œURL"
        />
        
        {/* YouTube URL */}
        <input
          type="url"
          value={song.youtubeUrl}
          onChange={(e) => updateSong(songIndex, 'youtubeUrl', e.target.value)}
          placeholder="YouTube URL"
        />
        
        {/* ãƒ‘ãƒ¼ãƒˆå‰²å½“ */}
        <div>
          <h4>ãƒ‘ãƒ¼ãƒˆå‰²å½“</h4>
          {song.parts.map((part, partIndex) => (
            <div key={partIndex} className="flex gap-2">
              <select
                value={part.instrument}
                onChange={(e) => updatePart(songIndex, partIndex, 'instrument', e.target.value)}
              >
                <option value="vocal">ğŸ¤ ãƒœãƒ¼ã‚«ãƒ«</option>
                <option value="electric_guitar">ğŸ¸ ã‚¨ãƒ¬ã‚­ã‚®ã‚¿ãƒ¼</option>
                <option value="bass">ğŸ¸ ãƒ™ãƒ¼ã‚¹</option>
                <option value="drums">ğŸ¥ ãƒ‰ãƒ©ãƒ </option>
                <option value="keyboard">ğŸ¹ ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰</option>
                <option value="other">ğŸµ ãã®ä»–</option>
              </select>
              <input
                type="text"
                value={part.player}
                onChange={(e) => updatePart(songIndex, partIndex, 'player', e.target.value)}
                placeholder="æ‹…å½“è€…å"
              />
              <button type="button" onClick={() => removePart(songIndex, partIndex)}>å‰Šé™¤</button>
            </div>
          ))}
          <button type="button" onClick={() => addPart(songIndex)}>+ ãƒ‘ãƒ¼ãƒˆè¿½åŠ </button>
        </div>
      </div>
    ))}
    <button type="button" onClick={addSong}>+ èª²é¡Œæ›²è¿½åŠ </button>
  </div>
</form>
```

**èª²é¡Œæ›²ãƒ‡ãƒ¼ã‚¿ã®JSONä¿å­˜:**

```typescript
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ (Prisma)
model Event {
  id        String   @id @default(cuid())
  title     String
  content   String
  date      DateTime
  songs     String?  // JSONæ–‡å­—åˆ—ã¨ã—ã¦ä¿å­˜
  // ...
}

// ä¿å­˜æ™‚
const res = await fetch('/api/events', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    ...formData,
    songs: JSON.stringify(formData.songs)  // JSONæ–‡å­—åˆ—åŒ–
  })
})

// å–å¾—æ™‚
const event = await prisma.event.findUnique({ where: { id } })
const songs = event.songs ? JSON.parse(event.songs) : []
```

---

## 32.4 ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒšãƒ¼ã‚¸

### src/app/activity-schedules/page.tsx

è¤‡æ•°ã®å€™è£œæ—¥ã‚’æŒã¤ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç®¡ç†ã—ã¾ã™ã€‚

```typescript
// æ¥½è¦³çš„UIæ›´æ–°ã®ä¾‹ï¼ˆå‚åŠ ç™»éŒ²ï¼‰
const handleParticipate = async (scheduleId: string) => {
  if (!session?.user?.id) return

  const userId = session.user.id
  const isCurrentlyParticipating = schedules.find(s => s.id === scheduleId)
    ?.participants.some(p => p.userId === userId)

  // â‘  å…ˆã«ç”»é¢ã‚’æ›´æ–°
  setSchedules(prevSchedules => prevSchedules.map(s => {
    if (s.id === scheduleId) {
      if (isCurrentlyParticipating) {
        return {
          ...s,
          participants: s.participants.filter(p => p.userId !== userId)
        }
      } else {
        return {
          ...s,
          participants: [...s.participants, {
            id: 'temp-' + Date.now(),  // ä¸€æ™‚ID
            userId,
            user: {
              id: userId,
              name: session.user.name || '',
              email: session.user.email || ''
            },
            createdAt: new Date().toISOString()
          }]
        }
      }
    }
    return s
  }))

  // â‘¡ APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  try {
    const res = await fetch(`/api/activity-schedules/${scheduleId}/participate`, {
      method: 'POST'
    })

    if (!res.ok) {
      // å¤±æ•—ã—ãŸã‚‰å…ƒã«æˆ»ã™
      fetchSchedules()
    }
  } catch (error) {
    console.error('å‚åŠ ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error)
    fetchSchedules()
  }
}
```

### src/app/users/page.tsxï¼ˆç®¡ç†è€…ã®ã¿ï¼‰

```typescript
'use client'

import { useState, useEffect } from 'react'
import { useSession } from 'next-auth/react'
import { useRouter } from 'next/navigation'
import DashboardLayout from '@/components/DashboardLayout'

export default function UsersPage() {
  const { data: session, status } = useSession()
  const router = useRouter()
  const [users, setUsers] = useState([])
  const [loading, setLoading] = useState(true)

  const isSiteAdmin = session?.user?.role === 'site_admin'

  // èªè¨¼ãƒã‚§ãƒƒã‚¯
  useEffect(() => {
    if (status === 'loading') return
    
    if (!session || !isSiteAdmin) {
      router.replace('/')  // æ¨©é™ãŒãªã„å ´åˆã¯ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸
      return
    }
    
    fetchUsers()
  }, [session, isSiteAdmin, router, status])

  const fetchUsers = async () => {
    try {
      const res = await fetch('/api/users')
      if (res.ok) {
        const data = await res.json()
        setUsers(data)
      }
    } catch (error) {
      console.error('Failed to fetch users:', error)
    } finally {
      setLoading(false)
    }
  }

  // å½¹å‰²å¤‰æ›´ï¼ˆæ¥½è¦³çš„UIæ›´æ–°ï¼‰
  const confirmRoleChange = async (userId: string, newRole: string) => {
    // å…ˆã«ç”»é¢ã‚’æ›´æ–°
    setUsers(prevUsers => prevUsers.map(u => 
      u.id === userId ? { ...u, role: newRole } : u
    ))

    try {
      const res = await fetch(`/api/users/${userId}`, {
        method: 'PATCH',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ role: newRole })
      })

      if (!res.ok) {
        fetchUsers()  // å¤±æ•—ã—ãŸã‚‰å…ƒã«æˆ»ã™
        alert('å½¹å‰²ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ')
      }
    } catch (error) {
      fetchUsers()
      alert('å½¹å‰²ã®å¤‰æ›´ã«å¤±æ•—ã—ã¾ã—ãŸ')
    }
  }

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ï¼ˆæ¥½è¦³çš„UIæ›´æ–°ï¼‰
  const handleDelete = async (userId: string) => {
    if (!confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return

    // å…ˆã«ç”»é¢ã‹ã‚‰å‰Šé™¤
    setUsers(prevUsers => prevUsers.filter(u => u.id !== userId))

    try {
      const res = await fetch(`/api/users/${userId}`, {
        method: 'DELETE'
      })

      if (!res.ok) {
        fetchUsers()  // å¤±æ•—ã—ãŸã‚‰å…ƒã«æˆ»ã™
        alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')
      }
    } catch (error) {
      fetchUsers()
      alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ')
    }
  }

  if (!isSiteAdmin) {
    return null  // æ¨©é™ãŒãªã„å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
  }

  return (
    <DashboardLayout>
      <div className="max-w-6xl mx-auto p-6">
        <h1 className="text-3xl font-bold mb-8">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h1>
        {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã®å®Ÿè£…... */}
      </div>
    </DashboardLayout>
  )
}
```

**æ¨©é™ãƒã‚§ãƒƒã‚¯ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã€‘
  useEffect(() => {
    if (status === 'loading') return  // â‘  èªè¨¼çŠ¶æ…‹ç¢ºå®šã¾ã§å¾…ã¤
    
    if (!session || !isSiteAdmin) {
      router.replace('/')  // â‘¡ æ¨©é™ãŒãªã„å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      return
    }
    
    fetchData()  // â‘¢ æ¨©é™ãŒã‚ã‚Œã°ãƒ‡ãƒ¼ã‚¿å–å¾—
  }, [session, status, router])

  if (!isSiteAdmin) {
    return null  // â‘£ æ¨©é™ãŒãªã„å ´åˆã¯ä½•ã‚‚è¡¨ç¤ºã—ãªã„
  }


ã€ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆAPI Routeï¼‰ã€‘
  export async function GET(req: Request) {
    const session = await auth()
    
    if (!session || session.user.role !== 'site_admin') {
      return NextResponse.json(
        { error: 'Unauthorized' },
        { status: 403 }
      )
    }
    
    // ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
  }

â†’ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¨ã‚µãƒ¼ãƒãƒ¼å´ã§äºŒé‡ã«ãƒã‚§ãƒƒã‚¯
```

---

## 32.5 èªè¨¼ãƒšãƒ¼ã‚¸

### src/app/auth/signin/page.tsx

```typescript
'use client'

import { signIn } from 'next-auth/react'
import { useState, useEffect } from 'react'
import { useRouter, useSearchParams } from 'next/navigation'
import Link from 'next/link'

export default function SignIn() {
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [error, setError] = useState('')
  const [message, setMessage] = useState('')
  const router = useRouter()
  const searchParams = useSearchParams()

  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
  useEffect(() => {
    const verified = searchParams.get('verified')
    const reset = searchParams.get('reset')

    if (verified === 'true') {
      setMessage('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚')
    } else if (reset === 'success') {
      setMessage('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚')
    }
  }, [searchParams])

  // ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setError('')
    setMessage('')
    
    const result = await signIn('credentials', {
      email,
      password,
      redirect: false,  // æ‰‹å‹•ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ¶å¾¡
      callbackUrl: '/'
    })
    
    if (result?.error) {
      setError('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“')
      return
    }
    
    if (result?.ok) {
      window.location.href = '/'  // ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰
    }
  }

  // Google OAuthèªè¨¼
  const handleGoogleSignIn = async () => {
    await signIn('google', { 
      callbackUrl: '/',
      redirect: true
    })
  }

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4">
      <div className="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
        <h1 className="text-3xl font-bold mb-6 text-center">BOLD è»½éŸ³</h1>
        
        {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º */}
        {message && (
          <div className="mb-4 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg">
            {message}
          </div>
        )}
        {error && (
          <div className="mb-4 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg">
            {error}
          </div>
        )}
        
        {/* ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ  */}
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-2">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              className="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-2">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-4 py-2.5 border rounded-lg focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>
          <button
            type="submit"
            className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-semibold"
          >
            ãƒ­ã‚°ã‚¤ãƒ³
          </button>
        </form>

        <div className="mt-4 text-center">
          <Link href="/auth/forgot-password" className="text-sm text-blue-600 hover:text-blue-700">
            ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã§ã™ã‹ï¼Ÿ
          </Link>
        </div>
        
        {/* åŒºåˆ‡ã‚Šç·š */}
        <div className="mt-4 relative">
          <div className="absolute inset-0 flex items-center">
            <div className="w-full border-t border-gray-300"></div>
          </div>
          <div className="relative flex justify-center text-sm">
            <span className="px-2 bg-white text-gray-500">ã¾ãŸã¯</span>
          </div>
        </div>

        {/* Google OAuth */}
        <button
          onClick={handleGoogleSignIn}
          className="w-full mt-4 bg-white text-gray-700 py-3 rounded-lg border hover:bg-gray-50 font-semibold flex items-center justify-center gap-2"
        >
          <svg className="w-5 h-5" viewBox="0 0 24 24">
            {/* Google ã‚¢ã‚¤ã‚³ãƒ³ SVG */}
          </svg>
          Googleã§ãƒ­ã‚°ã‚¤ãƒ³
        </button>
        
        <div className="mt-4 text-center">
          <Link href="/auth/signup" className="text-sm text-blue-600 hover:text-blue-700">
            ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯ã“ã¡ã‚‰
          </Link>
        </div>
      </div>
    </div>
  )
}
```

**èªè¨¼ã®å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     NextAuth.js ã®ä½¿ã„æ–¹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€1. ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã€‘
  const result = await signIn('credentials', {
    email,
    password,
    redirect: false  // æ‰‹å‹•ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ¶å¾¡
  })
  
  if (result?.error) {
    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
  } else {
    // æˆåŠŸæ™‚ã®å‡¦ç†
    window.location.href = '/'
  }


ã€2. Google OAuthèªè¨¼ã€‘
  const handleGoogleSignIn = () => {
    signIn('google', { callbackUrl: '/' })
  }
  
  â†’ NextAuth.jsãŒè‡ªå‹•ã§OAuth ãƒ•ãƒ­ãƒ¼ã‚’å‡¦ç†
  â†’ Googleèªè¨¼ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  â†’ èªè¨¼å¾Œã€callbackUrlã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ


ã€3. ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã®å–å¾—ã€‘
  // Client Component
  const { data: session, status } = useSession()
  
  // Server Component
  const session = await auth()
  
  â†’ Client: useSession() ãƒ•ãƒƒã‚¯
  â†’ Server: auth() é–¢æ•°


ã€4. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¼é”ã€‘
  const searchParams = useSearchParams()
  const verified = searchParams.get('verified')
  
  if (verified === 'true') {
    setMessage('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒç¢ºèªã•ã‚Œã¾ã—ãŸ')
  }
  
  â†’ ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¸¡ã™
  â†’ ã‚»ã‚­ãƒ¥ã‚¢ãªæ–¹æ³•ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼æ¸ˆã¿ï¼‰
```

---

## ğŸ“‹ ãƒšãƒ¼ã‚¸å®Ÿè£…ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… Server Component + Client Component ã®åˆ†é›¢
  - ãƒ‡ãƒ¼ã‚¿å–å¾— â†’ Server Component
  - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ â†’ Client Component
  - ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®ã‚ˆã†ãªè¤‡é›‘ãªãƒšãƒ¼ã‚¸ã§æœ‰åŠ¹

âœ… çµ±åˆãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
  - ä¸€è¦§ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã‚’1ã¤ã®ãƒšãƒ¼ã‚¸ã«çµ±åˆ
  - ãƒšãƒ¼ã‚¸é·ç§»ãªã—ã§æ“ä½œå®Œçµ
  - æ¥½è¦³çš„UIæ›´æ–°ãŒå®¹æ˜“

âœ… æ¥½è¦³çš„UIæ›´æ–°ï¼ˆOptimistic UIï¼‰
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¾Œã€å³åº§ã«ç”»é¢ã‚’æ›´æ–°
  - APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ä¸¦è¡Œã—ã¦å®Ÿè¡Œ
  - å¤±æ•—æ™‚ã¯å…ƒã«æˆ»ã™

âœ… ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†
  - ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
  - LoadingSpinner ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§çµ±ä¸€

âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
  - ã‚ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’è€ƒæ…®ã—ãŸæƒ…å ±å…¬é–‹

âœ… ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã¨ã‚µãƒ¼ãƒãƒ¼å´ã§äºŒé‡ãƒã‚§ãƒƒã‚¯
  - æ¨©é™ãŒãªã„å ´åˆã¯ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

âœ… ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
  - ãƒ¢ãƒã‚¤ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
  - Tailwind CSSã®ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨
```

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

æ¬¡ã®ç« ã§ã¯ã€API Routesã¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®è©³ç´°ã‚’è§£èª¬ã—ã¾ã™ï¼š

- **Chapter 31**: API Routesã®è©³ç´°è§£èª¬
- **Chapter 33**: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®è©³ç´°è§£èª¬

---

[â† å‰ã®ç« ï¼šç¬¬31ç«  API Routesã®è©³ç´°è§£èª¬](31-API-Routesã®è©³ç´°è§£èª¬.md) | [ç›®æ¬¡ã«æˆ»ã‚‹](00-ç›®æ¬¡.md) | [æ¬¡ã®ç« ã¸ï¼šç¬¬33ç«  ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®è©³ç´°è§£èª¬ â†’](33-ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®è©³ç´°è§£èª¬.md)
